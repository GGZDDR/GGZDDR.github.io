<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>DirectX SDK学习笔记 | ZDDR's blog</title><meta name="keywords" content="ZDDR,逆向,内核,Pwn"><meta name="author" content="ZDDR"><meta name="copyright" content="ZDDR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="创建一个窗口创建窗口需要那些步骤？ 1.注册窗口类 2.创建窗口实例 3.显示窗口 4.更新窗口 5.建立消息循环 6.实现窗口过程函数  使用RegisterClass注册窗口类RegisterClass的作用是告知系统我们所需要的窗口风格 123ATOM RegisterClass(    const WNDCLASS *lpWndClass    );  参数 lpWndClass为指向WN">
<meta property="og:type" content="article">
<meta property="og:title" content="DirectX SDK学习笔记">
<meta property="og:url" content="https://zddr.net/2020/09/15/Windows%20SDK/index.html">
<meta property="og:site_name" content="ZDDR&#39;s blog">
<meta property="og:description" content="创建一个窗口创建窗口需要那些步骤？ 1.注册窗口类 2.创建窗口实例 3.显示窗口 4.更新窗口 5.建立消息循环 6.实现窗口过程函数  使用RegisterClass注册窗口类RegisterClass的作用是告知系统我们所需要的窗口风格 123ATOM RegisterClass(    const WNDCLASS *lpWndClass    );  参数 lpWndClass为指向WN">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2020/09/17/wWSbKs.png">
<meta property="article:published_time" content="2020-09-14T16:00:00.000Z">
<meta property="article:modified_time" content="2020-11-09T16:00:00.000Z">
<meta property="article:author" content="ZDDR">
<meta property="article:tag" content="ZDDR,逆向,内核,Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/09/17/wWSbKs.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zddr.net/2020/09/15/Windows%20SDK/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: ZDDR","link":"链接: ","source":"来源: ZDDR's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-10 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://gitee.com/ZDDR/blog_img/raw/master/img/index_img/%E8%87%AA%E5%B7%B1%E7%9A%84%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/09/17/wWSbKs.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ZDDR's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DirectX SDK学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-09-14T16:00:00.000Z" title="发表于 2020-09-15 00:00:00">2020-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-09T16:00:00.000Z" title="更新于 2020-11-10 00:00:00">2020-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/windows%E7%BC%96%E7%A8%8B/">windows编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="创建一个窗口"><a href="#创建一个窗口" class="headerlink" title="创建一个窗口"></a>创建一个窗口</h1><h2 id="创建窗口需要那些步骤？"><a href="#创建窗口需要那些步骤？" class="headerlink" title="创建窗口需要那些步骤？"></a>创建窗口需要那些步骤？</h2><ul>
<li>1.注册窗口类</li>
<li>2.创建窗口实例</li>
<li>3.显示窗口</li>
<li>4.更新窗口</li>
<li>5.建立消息循环</li>
<li>6.实现窗口过程函数</li>
</ul>
<h2 id="使用RegisterClass注册窗口类"><a href="#使用RegisterClass注册窗口类" class="headerlink" title="使用RegisterClass注册窗口类"></a>使用RegisterClass注册窗口类</h2><p><strong>RegisterClass</strong>的作用是告知系统我们所需要的窗口风格</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ATOM <span class="title">RegisterClass</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> WNDCLASS *lpWndClass</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>; </span><br></pre></td></tr></table></figure>
<p>参数 <strong>lpWndClass</strong>为指向<strong>WNDCLASS</strong>结构体的指针</p>
<p><strong>WNDCLASS</strong>结构体：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">WNDCLASS</span> &#123;</span> </span><br><span class="line">    UINT       style; <span class="comment">//风格</span></span><br><span class="line">    <span class="comment">//一般填下面两项（当窗口被修改时，系统会通知窗口重新绘制界面）。</span></span><br><span class="line">    <span class="comment">//CS_VREDRAW || CS_HREDRAW</span></span><br><span class="line">    WNDPROC    lpfnWndProc; <span class="comment">//回调函数</span></span><br><span class="line">    <span class="keyword">int</span>        cbClsExtra;  <span class="comment">//额外大小，窗口类使用</span></span><br><span class="line">    <span class="keyword">int</span>        cbWndExtra;  <span class="comment">//额外大小，窗口实例使用</span></span><br><span class="line">    <span class="comment">//不使用额外大小，填0即可</span></span><br><span class="line">    HINSTANCE  hInstance; <span class="comment">//窗口句柄，可以从main函数的参数中获取。</span></span><br><span class="line">    HICON      hIcon; <span class="comment">//图标</span></span><br><span class="line">    HCURSOR    hCursor; <span class="comment">//光标</span></span><br><span class="line">    HBRUSH     hbrBackground; <span class="comment">//背景颜色</span></span><br><span class="line">    <span class="comment">//以上三项，没有可以填NULL</span></span><br><span class="line">    LPCTSTR    lpszMenuName; <span class="comment">//菜单名称，没有可以填NULL</span></span><br><span class="line">    LPCTSTR    lpszClassName; <span class="comment">//窗口类的名字</span></span><br><span class="line">&#125; WNDCLASS, *PWNDCLASS; </span><br></pre></td></tr></table></figure>
<p>此结构体详细参数可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/ns-winuser-wndclassa">WNDCLASSA structure]</a></p>
<p>提供给此结构体<strong>lpfnWndProc</strong>参数的<strong>回调函数</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  _In_ HWND   hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">  _In_ UINT   uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">  _In_ WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">  _In_ LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>注册窗口类：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义回调函数</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	HWND   hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">	UINT   uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">	WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">	LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">APIENTRY: __stdcall调用约定</span></span><br><span class="line"><span class="comment">_In_ : 说明性宏</span></span><br><span class="line"><span class="comment">HINSTANCE hInstance : 实例句柄，代表应用程序本身。</span></span><br><span class="line"><span class="comment">HINSTANCE hPrevInstance : 已弃用，为了兼容老的入口函数。</span></span><br><span class="line"><span class="comment">LPWSTR lpCmdLine : 命令行参数。</span></span><br><span class="line"><span class="comment">int nCmdShow : 控制显示。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> APIENTRY <span class="title">wWinMain</span><span class="params">(_In_ HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_opt_ HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_ LPWSTR    lpCmdLine,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_ <span class="keyword">int</span>       nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//设计注册窗口类的结构体</span></span><br><span class="line">	WNDCLASS wc;</span><br><span class="line">	wc.style = CS_VREDRAW | CS_VREDRAW;</span><br><span class="line">	wc.lpfnWndProc = WindowProc;</span><br><span class="line">	wc.cbClsExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wc.cbWndExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hInstance = hPrevInstance;</span><br><span class="line">	wc.hIcon = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hCursor = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hbrBackground = <span class="literal">NULL</span>;</span><br><span class="line">	wc.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">	wc.lpszClassName = TEXT(<span class="string">&quot;NEWCLASS&quot;</span>);</span><br><span class="line">	<span class="comment">//使用结构体注册窗口类</span></span><br><span class="line">	ATOM ret = RegisterClass(&amp;wc);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断注册窗口类是否成功</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;注册窗口类成功&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用CreateWindow创建窗口实例"><a href="#使用CreateWindow创建窗口实例" class="headerlink" title="使用CreateWindow创建窗口实例"></a>使用CreateWindow创建窗口实例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HWND CreateWindow</span><br><span class="line">( </span><br><span class="line">  LPCTSTR lpClassName,  <span class="comment">// 类名</span></span><br><span class="line">  LPCTSTR lpWindowName, <span class="comment">// 标题 </span></span><br><span class="line">  DWORD dwStyle,        <span class="comment">// 风格</span></span><br><span class="line">  <span class="comment">/*三种基本风格：其他风格都是依次为基础添加的</span></span><br><span class="line"><span class="comment">  WS_CHILD:子窗口</span></span><br><span class="line"><span class="comment">  WS_OVERLAPPED:重叠 WS_OVERLAPPEDWINDOW:重叠PLUS版 要用肯定用PLUS版</span></span><br><span class="line"><span class="comment">  WS_POPUP:对话框</span></span><br><span class="line"><span class="comment">  这三种风格互斥，且必须有一个，</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="comment">//xy坐标，窗口宽高，如果不想填写可以使用 CW_USEDEFAULT</span></span><br><span class="line">  <span class="keyword">int</span> x,              </span><br><span class="line">  <span class="keyword">int</span> y,               </span><br><span class="line">  <span class="keyword">int</span> nWidth,          </span><br><span class="line">  <span class="keyword">int</span> nHeight,          </span><br><span class="line">  HWND hWndParent,      <span class="comment">// 父窗口</span></span><br><span class="line">  HMENU hMenu,          <span class="comment">// 菜单</span></span><br><span class="line">  HINSTANCE hInstance,  <span class="comment">// 实例句柄</span></span><br><span class="line">  LPVOID lpParam        <span class="comment">// 参数，没有参数填NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>使用CreateWindow创建窗口实例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建窗口实例</span></span><br><span class="line">	HWND hWnd = CreateWindow(</span><br><span class="line">		TEXT(<span class="string">&quot;NEWCLASS&quot;</span>),</span><br><span class="line">		TEXT(<span class="string">&quot;Text Window&quot;</span>),</span><br><span class="line">		WS_OVERLAPPEDWINDOW,</span><br><span class="line">		<span class="number">600</span>, <span class="number">600</span>, <span class="number">600</span>, <span class="number">600</span>,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		hInstance,</span><br><span class="line">		<span class="literal">NULL</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hWnd != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;创建窗口实例成功&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用ShowWindow显示窗口"><a href="#使用ShowWindow显示窗口" class="headerlink" title="使用ShowWindow显示窗口"></a>使用ShowWindow显示窗口</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">ShowWindow</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd,     <span class="comment">// 窗口句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span> nCmdShow   <span class="comment">// 显示状态</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>直接将上面创建窗口实例返回的句柄传给<strong>ShowWindow</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShowWindow(hWnd, SW_SHOW);</span><br></pre></td></tr></table></figure>
<p><strong>ShowWindow</strong>显示状态的详细参数可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/aa932387(v=msdn.10)">ShowWindow]</a></p>
<p>运行后就可以看到任务栏出现了一个窗口<br><img src="https://s1.ax1x.com/2020/09/16/wgTAtP.png" alt="img"></p>
<h2 id="使用UpdateWindow更新窗口"><a href="#使用UpdateWindow更新窗口" class="headerlink" title="使用UpdateWindow更新窗口"></a>使用UpdateWindow更新窗口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPP</span><br><span class="line">BOOL UpdateWindow(</span><br><span class="line">  HWND hWnd</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>就传一个句柄，没啥好说的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UpdateWindow(hWnd);</span><br></pre></td></tr></table></figure>
<h2 id="建立消息循环"><a href="#建立消息循环" class="headerlink" title="建立消息循环"></a>建立消息循环</h2><p>如果要理解什么是“<strong>消息循环</strong>”首先要知道这样一个概念：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Windows是一个“基于事件的，消息驱动”的操作系统</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows消息机制</li>
</ul>
<p>在正常情况下，程序是无法直接操作输入输出设备（如鼠标、键盘、显示器等）的，因为所有的输入输出设备都被操作系统接管，关系图如下：<br><img src="https://s1.ax1x.com/2020/09/16/w2CdD1.png" alt="img"></p>
<p>但是这就会出现另一个问题，操作系统知道消息什么时候会来，但是不知道怎么处理这个消息，应用程序知道这个消息怎么处理，但是不知道消息什么时候会来。这个问题的解决方法就是使用<strong>回调函数</strong>。</p>
<ul>
<li>用户产生的消息千千万，系统是如何知道把哪个信息传递给哪个程序处理呢？</li>
</ul>
<p>首先软件开发者会在程序定义一个<strong>回调函数</strong>，程序运行后，操作系统会获得<strong>回调函数</strong>的地址，当接收到消息时，操作系统会通过<strong>回调函数</strong>将消息传递回给应用程序处理。</p>
<p>在Windows上执行一个程序，只要用户进行了影响窗口的动作（如键盘输入、鼠标点击、移动窗口等）该动作就会触发一个相应的“事件”，系统每次检测到一个事件时，就会通过回调函数给程序发送一个信息，从而使程序可以处理该事件。</p>
<p>当然，操作系统可不会来一条信息发一条给程序，等程序处理完了再发下一条，操作系统会将消息存入“<strong>消息队列</strong>”中，应用程序从队列中取出消息进行处理，处理完该条后，去从队列中取出下一条进行处理，依次循环，这个处理过程就叫做“<strong>消息循环</strong>”。</p>
<p><img src="https://s1.ax1x.com/2020/09/17/wRwcIs.png" alt="img"></p>
<p>建立消息循环需要两个步骤</p>
<ul>
<li>1.使用<strong>GetMessage</strong>从消息队列获取消息</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">GetMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  LPMSG lpMsg,         <span class="comment">// 指向MSG结构的指针，该结构从线程的消息队列接收消息信息。</span></span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd,           <span class="comment">// 窗口句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT wMsgFilterMin,  </span></span></span><br><span class="line"><span class="function"><span class="params">  UINT wMsgFilterMax   <span class="comment">//限制获取消息的最大最小值，一般为0（不限制）</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>MSG结构：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMSG</span> &#123;</span></span><br><span class="line">  HWND   hwnd;			<span class="comment">//窗口句柄，用于区分多个窗口</span></span><br><span class="line">  UINT   message;		<span class="comment">//消息标识符。应用程序只能使用低位字；高位字由系统保留。</span></span><br><span class="line">  WPARAM wParam;		<span class="comment">//有关消息的其他信息</span></span><br><span class="line">  LPARAM lParam;		<span class="comment">//有关消息的其他信息</span></span><br><span class="line">    </span><br><span class="line">  DWORD  time;			<span class="comment">//消息产生时间</span></span><br><span class="line">  POINT  pt;			<span class="comment">//消息发布时的光标位置，以屏幕坐标表示。</span></span><br><span class="line">  DWORD  lPrivate;</span><br><span class="line">&#125; MSG, *PMSG, *NPMSG, *LPMSG;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MSG msg;</span><br><span class="line">GetMessage(&amp;msg,mull,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>2.使用DispatchMessage将信息调度到窗口过程函数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">DispatchMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> MSG *lpMsg			<span class="comment">//指向包含消息的结构的指针。</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>直接将声明好的msg结构体传给它即可：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DispatchMessage(&amp;msg);</span><br></pre></td></tr></table></figure>
<ul>
<li>3.建立消息循环</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(GetMessage(&amp;msg,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    DispatchMessage(&amp;msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现窗口过程函数"><a href="#实现窗口过程函数" class="headerlink" title="实现窗口过程函数"></a>实现窗口过程函数</h2><p>因为现在还用不到接收到的信息，所以就直接使用<strong>DefWindowProc</strong>函数让系统默认帮我们处理信息。</p>
<p>函数参数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT LRESULT <span class="title">DefWindowProcA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND   hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">  UINT   Msg,</span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>直接在回调函数中调用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	HWND   hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">	UINT   uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">	WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">	LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hwnd,uMsg,wParam,lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="窗口销毁"><a href="#窗口销毁" class="headerlink" title="窗口销毁"></a>窗口销毁</h2><p>如果窗口关闭后不进行窗口销毁，那么程序将会一直运行着消息循环，那么如何进行窗口销毁呢？<br>首先消息循环是建立在GetMessage的返回值上的，如果返回值为0，while循环自然会停止。<br>那么又如何让GetMessage返回0呢？微软文档是这样描述的：</p>
<blockquote>
<p>如果GetMessage函数检索到WM_QUIT以外的消息，则返回值为非零。<br>如果GetMessage函数检索WM_QUIT消息，则返回值为零。</p>
</blockquote>
<p>在我们点击关闭窗口时，会发送一个<strong>WM_CLOSE</strong>消息。</p>
<p>那么很简单，只需要在回调函数处理一下<strong>WM_CLOSE</strong>消息让，他给消息队列发送一个WM_QUIT消息即可。</p>
<p>这里需要用到<strong>PostQuitMessage</strong>函数发送<strong>WM_QUIT</strong>消息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PostQuitMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span> nExitCode			<span class="comment">//应用程序退出代码 随便填</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在回调函数中调用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">FirstWindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hwnd,      </span></span></span><br><span class="line"><span class="function"><span class="params">    UINT uMsg,    </span></span></span><br><span class="line"><span class="function"><span class="params">    WPARAM wParam, </span></span></span><br><span class="line"><span class="function"><span class="params">    LPARAM lParam </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">        <span class="comment">//向消息队列中投递一个WM_QUIT消息用来结束消息循环。</span></span><br><span class="line">        PostQuitMessage(<span class="number">0</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, uMsg, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义回调函数</span></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	HWND   hwnd,</span></span></span><br><span class="line"><span class="function"><span class="params">	UINT   uMsg,</span></span></span><br><span class="line"><span class="function"><span class="params">	WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">	LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> (uMsg)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_CLOSE:</span><br><span class="line"></span><br><span class="line">		<span class="comment">//向消息队列中投递一个WM_QUIT消息用来结束消息循环。</span></span><br><span class="line">		PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hwnd, uMsg, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">APIENTRY: __stdcall调用约定</span></span><br><span class="line"><span class="comment">_In_ : 说明性宏</span></span><br><span class="line"><span class="comment">HINSTANCE hInstance : 实例句柄，代表应用程序本身。</span></span><br><span class="line"><span class="comment">HINSTANCE hPrevInstance : 已弃用，为了兼容老的入口函数。</span></span><br><span class="line"><span class="comment">LPWSTR lpCmdLine : 命令行参数。</span></span><br><span class="line"><span class="comment">int nCmdShow : 控制显示。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> APIENTRY <span class="title">wWinMain</span><span class="params">(_In_ HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_opt_ HINSTANCE hPrevInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_ LPWSTR    lpCmdLine,</span></span></span><br><span class="line"><span class="function"><span class="params">	_In_ <span class="keyword">int</span>       nCmdShow)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//设计注册窗口类的结构体</span></span><br><span class="line">	WNDCLASS wc;</span><br><span class="line">	wc.style = CS_VREDRAW | CS_VREDRAW;</span><br><span class="line">	wc.lpfnWndProc = WindowProc;</span><br><span class="line">	wc.cbClsExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wc.cbWndExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hInstance = hPrevInstance;</span><br><span class="line">	wc.hIcon = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hCursor = <span class="literal">NULL</span>;</span><br><span class="line">	wc.hbrBackground = <span class="literal">NULL</span>;</span><br><span class="line">	wc.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">	wc.lpszClassName = TEXT(<span class="string">&quot;NEWCLASS&quot;</span>);</span><br><span class="line">	<span class="comment">//使用结构体注册窗口类</span></span><br><span class="line">	ATOM ret = RegisterClass(&amp;wc);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断注册窗口类是否失败</span></span><br><span class="line">	<span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;注册窗口类失败&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建窗口实例</span></span><br><span class="line">	HWND hWnd = CreateWindow(</span><br><span class="line">		TEXT(<span class="string">&quot;NEWCLASS&quot;</span>),</span><br><span class="line">		TEXT(<span class="string">&quot;Text Window&quot;</span>),</span><br><span class="line">		WS_OVERLAPPEDWINDOW,</span><br><span class="line">		<span class="number">600</span>, <span class="number">600</span>, <span class="number">600</span>, <span class="number">600</span>,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">		hInstance,</span><br><span class="line">		<span class="literal">NULL</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hWnd != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;创建窗口实例成功&quot;</span>), TEXT(<span class="string">&quot;提示&quot;</span>), MB_OK);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ShowWindow(hWnd, SW_SHOW);</span><br><span class="line">	UpdateWindow(hWnd);</span><br><span class="line"></span><br><span class="line">	MSG msg;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		DispatchMessage(&amp;msg);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="绘图消息"><a href="#绘图消息" class="headerlink" title="绘图消息"></a>绘图消息</h1><h2 id="什么是绘图消息？"><a href="#什么是绘图消息？" class="headerlink" title="什么是绘图消息？"></a>什么是绘图消息？</h2><p>当窗口出现“<strong>无效区</strong>“时，系统会检测并发送<strong>WM_PAINT</strong>消息。对窗口的无效区部分进行重新绘制。</p>
<h2 id="什么是无效区？"><a href="#什么是无效区？" class="headerlink" title="什么是无效区？"></a>什么是无效区？</h2><p>以下的几种情况会产生无效区：</p>
<ul>
<li>1.窗口创建</li>
<li>2.窗口尺寸修改</li>
<li>3.窗口最小化最大化</li>
<li>4.窗口被遮盖的部分重现</li>
</ul>
<p>看到上面四个产生无效区的情况，想必你已经能大概知道窗口会在何时产生<strong>无效区</strong>，当窗口（一部分或是全部）从屏幕上消失后，需要重新显示在屏幕上，消失的部分就被称为”<strong>无效区</strong>“。</p>
<h2 id="WM-PAINT消息定义"><a href="#WM-PAINT消息定义" class="headerlink" title="WM_PAINT消息定义"></a>WM_PAINT消息定义</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hwnd, </span></span></span><br><span class="line"><span class="function"><span class="params">  UINT  uMsg, </span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam, </span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam     </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="使用DrawText函数绘制文本"><a href="#使用DrawText函数绘制文本" class="headerlink" title="使用DrawText函数绘制文本"></a>使用DrawText函数绘制文本</h2><p>DrawText函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DrawText</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HDC     hdc,		<span class="comment">//设备上下文的句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPCTSTR lpchText, <span class="comment">//指向指定要绘制文本的字符串的指针</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span>     cchText,	<span class="comment">//字符串的长度（以字符为单位）</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPRECT  lprc,		<span class="comment">//指向RECT结构体的指针，该结构包含要在其中格式化文本的矩形</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT    format	<span class="comment">//文本格式</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>DrawText</strong>函数的第一个参数<strong>hdc</strong>在官方文档的描述是<code>设备上下文的句柄</code>.</p>
<p>DC的全称是（<strong>Device Context</strong>）Ennnn…. 这又是个啥玩意？</p>
<p>在以前的DOS系统上，系统把屏幕抽象成了一个内存，直接往相应的内存空间中写入内容即可在屏幕上进行输出。而在Windows系统中则将屏幕抽象成了<strong>DC</strong>，操作<strong>DC</strong>即可在屏幕上进行输出。</p>
<p><strong>RECT</strong>结构体：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagRECT</span> &#123;</span></span><br><span class="line">  LONG left;  <span class="comment">//指定矩形左上角的x坐标</span></span><br><span class="line">  LONG top;	  <span class="comment">//指定矩形左上角的y坐标。</span></span><br><span class="line">  LONG right; <span class="comment">//指定矩形右下角的x坐标。</span></span><br><span class="line">  LONG bottom;<span class="comment">//指定矩形右下角的y坐标。</span></span><br><span class="line">&#125; RECT, *PRECT, *NPRECT, *LPRECT;</span><br></pre></td></tr></table></figure>
<h2 id="使用BeginPaint获取DC"><a href="#使用BeginPaint获取DC" class="headerlink" title="使用BeginPaint获取DC"></a>使用BeginPaint获取DC</h2><p>BeginPaint定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HDC <span class="title">BeginPaint</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND          hWnd,   <span class="comment">//处理要重绘的窗口</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPPAINTSTRUCT lpPaint <span class="comment">//指向将接收绘画信息的PAINTSTRUCT结构的指针。</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="使用EndPaint释放DC"><a href="#使用EndPaint释放DC" class="headerlink" title="使用EndPaint释放DC"></a>使用EndPaint释放DC</h2><p>在DC资源使用完之后，必须要对其进行释放，否则GDI对象的占用数将会越来越高。<br>EndPaint定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">EndPaint</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND              hWnd,    <span class="comment">//处理已重新绘制的窗口。</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> PAINTSTRUCT *lpPaint <span class="comment">//指向一个PAINTSTRUCT结构的指针，该结构包含BeginPaint检索的绘画信息。</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_PAINT:<span class="comment">//绘图消息</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取DC句柄</span></span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    HDC hDC= BeginPaint(hwnd, &amp;ps);</span><br><span class="line">    <span class="comment">//绘制文本</span></span><br><span class="line">    <span class="keyword">char</span> szBuff[] = &#123; <span class="string">&quot;Hello World&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    RECT rc = &#123;</span><br><span class="line">        <span class="number">600</span>,<span class="number">600</span>    <span class="comment">//左上角</span></span><br><span class="line">        <span class="number">0</span>,<span class="number">0</span> <span class="comment">//右下角</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    DrawText(</span><br><span class="line">        hDC,</span><br><span class="line">        szBuff,</span><br><span class="line">        <span class="built_in">strlen</span>(szBuff),</span><br><span class="line">        &amp;rc,</span><br><span class="line">        DT_CENTER</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放资源</span></span><br><span class="line">    EndPaint(hwnd, &amp;ps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在系统不发送WM-PAINT消息时绘图"><a href="#在系统不发送WM-PAINT消息时绘图" class="headerlink" title="在系统不发送WM_PAINT消息时绘图"></a>在系统不发送WM_PAINT消息时绘图</h2><h3 id="使用InvalidateRect函数手动发送WM-PAINT消息"><a href="#使用InvalidateRect函数手动发送WM-PAINT消息" class="headerlink" title="使用InvalidateRect函数手动发送WM_PAINT消息"></a>使用InvalidateRect函数手动发送WM_PAINT消息</h3><p>使用InvalidateRect手动制造一块需要绘制的区域(手动产生无效区)。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">InvalidateRect</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND       hWnd,   <span class="comment">//窗口的句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">const</span> RECT *lpRect,<span class="comment">//需要重新绘制的矩形大小，填NULL整个客户区重新绘制</span></span></span></span><br><span class="line"><span class="function"><span class="params">  BOOL       bErase	 <span class="comment">//是否擦除背景</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvalidateRect(hWnd, <span class="literal">NULL</span>, TRUE);</span><br></pre></td></tr></table></figure>
<h3 id="使用GetDC函数"><a href="#使用GetDC函数" class="headerlink" title="使用GetDC函数"></a>使用GetDC函数</h3><p>GetDC函数检索指定窗口的客户区域或整个屏幕的设备上下文（DC）的句柄。可以在后续的GDI函数中使用返回的句柄来绘制DC。</p>
<p>函数原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HDC <span class="title">GetDC</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HDC hDc = GetDC(hwnd);</span><br></pre></td></tr></table></figure>
<p>使用GetDC后对应使用ReleaseDC来释放空间。</p>
<p>函数原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ReleaseDC</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hWnd,  <span class="comment">// handle to window  </span></span></span></span><br><span class="line"><span class="function"><span class="params">    HDC hDC     <span class="comment">// handle to DC</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="BeginPaint和GetDC的区别"><a href="#BeginPaint和GetDC的区别" class="headerlink" title="BeginPaint和GetDC的区别"></a>BeginPaint和GetDC的区别</h2><ol>
<li>BeginPaint会清除无效区，GetDC不会。</li>
<li>BeginPaint绘制区域不超过无效区。</li>
<li>GetDC无视无效区。</li>
<li>BeginPaint只能在PAINT消息中使用。</li>
</ol>
<p>简要区分：BeginPaint在WM_PAINT消息中使用，其他地方用GetDC。</p>
<h1 id="键盘消息"><a href="#键盘消息" class="headerlink" title="键盘消息"></a>键盘消息</h1><h2 id="WM-KEYDOWN信息"><a href="#WM-KEYDOWN信息" class="headerlink" title="WM_KEYDOWN信息"></a><strong>WM_KEYDOWN</strong>信息</h2><p>在键盘按下时会发送<strong>WM_KEYDOWN</strong>信息</p>
<p><strong>WM_KEYDOWN</strong>的定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hwnd,       <span class="comment">// handle to window</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT uMsg,       <span class="comment">// WM_KEYDOWN </span></span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,   <span class="comment">// virtual-key code 虚拟码</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam    <span class="comment">// key data 扫描码</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>注意！<strong>WM_KEYDOWN</strong>是无法区分大小写的，如要区分大小写，需要使用WM_CHAR来处理消息。</p>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_KEYDOWN:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    wsprintf(szBuff,<span class="string">&quot;[TEXT] %c&quot;</span>,wParam);</span><br><span class="line">    OutputDebugString(szBuff);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用”<strong>OutputDebugString</strong>“后，键盘消息就可以被DebugView检测到</p>
<p><img src="https://s1.ax1x.com/2020/09/19/w5EwPH.png" alt="img"></p>
<h2 id="WM-CHAR消息"><a href="#WM-CHAR消息" class="headerlink" title="WM_CHAR消息"></a>WM_CHAR消息</h2><p>如果要使用<strong>WM_CHAR</strong>消息区分大小写，需要在消息循环使用<strong>TranslateMessage</strong>函数将<strong>WM_KEYDOWN</strong>消息转换为<strong>WM_CHAR</strong>消息。</p>
<p>TranslateMessage函数原形：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">TranslateMessage</span><span class="params">(  </span></span></span><br><span class="line"><span class="function"><span class="params">    CONST MSG *lpMsg   <span class="comment">// message information</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用时只需要将msg的结构体指针传给他就行：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MSG msg;</span><br><span class="line"><span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))<span class="comment">//拿到所有消息</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//将WM_KEYDOWN消息转换为WM_CHAR消息</span></span><br><span class="line">    TranslateMessage(&amp;msg);</span><br><span class="line">    <span class="comment">//调用回调函数</span></span><br><span class="line">    DispatchMessage(&amp;msg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//回调函数内部   </span></span><br><span class="line"><span class="keyword">case</span> WM_CHAR:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    wsprintf(szBuff, <span class="string">&quot;CHAR: %c&quot;</span>, wParam);</span><br><span class="line">    OutputDebugString(szBuff);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用WM-CHAR处理中文"><a href="#使用WM-CHAR处理中文" class="headerlink" title="使用WM_CHAR处理中文"></a>使用WM_CHAR处理中文</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_CHAR:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> nIdx = <span class="number">0</span>;</span><br><span class="line">    szBuff[nIdx++] = wParam;</span><br><span class="line">    <span class="keyword">char</span> szBuffFmt[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    wsprintf(szBuffFmt, <span class="string">&quot;[TEXT] char: %s&quot;</span>, szBuff);</span><br><span class="line">    OutputDebugString(szBuffFmt);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="鼠标消息"><a href="#鼠标消息" class="headerlink" title="鼠标消息"></a>鼠标消息</h1><p>鼠标信息有非常的多，这里就不一 一举例了，需要处理哪一种消息，只需要在回调函数中定义就行。</p>
<p>这里使用<strong>WM_LBUTTONDOWN</strong>（鼠标左键单击）作为例子</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_LBUTTONDOWN:</span><br><span class="line">&#123;</span><br><span class="line">	WORD xPos = GET_X_LPARAM(lParam);<span class="comment">//需要调用windowsx.h头文件</span></span><br><span class="line">	WORD yPos = GET_Y_LPARAM(lParam);</span><br><span class="line"></span><br><span class="line">	CHAR szBuff[MAXBYTE] = &#123; <span class="string">&#x27;\0&#x27;</span> &#125;;</span><br><span class="line">	wsprintf(szBuff, TEXT(<span class="string">&quot;x:%d y:%d&quot;</span>), xPos, yPos);</span><br><span class="line">	MessageBox(hwnd, szBuff, TEXT(<span class="string">&quot;坐标&quot;</span>), MB_OK);</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多鼠标消息可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/inputdev/mouse-input">mouse-input]</a></p>
<h1 id="定时器消息"><a href="#定时器消息" class="headerlink" title="定时器消息"></a>定时器消息</h1><h2 id="使用SetTimer函数设置定时器"><a href="#使用SetTimer函数设置定时器" class="headerlink" title="使用SetTimer函数设置定时器"></a>使用SetTimer函数设置定时器</h2><p>在设置定时器之后，定时器会每隔一段时间给窗口发一次<strong>WM_TIMER</strong>消息。</p>
<p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">UINT_PTR <span class="title">SetTimer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND      hWnd,		<span class="comment">//窗口句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT_PTR  nIDEvent,	<span class="comment">//定时器ID，必须为非0</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT      uElapse,	<span class="comment">//时间间隔(毫秒)</span></span></span></span><br><span class="line"><span class="function"><span class="params">  TIMERPROC lpTimerFunc <span class="comment">//当时间到了以后执行回调函数，可以设置为NULL</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetTimer(hwnd,<span class="number">1</span>,<span class="number">1000</span>,<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<h2 id="WM-TIMER消息"><a href="#WM-TIMER消息" class="headerlink" title="WM_TIMER消息"></a>WM_TIMER消息</h2><p>定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hwnd,       <span class="comment">// handle to window</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT uMsg,       <span class="comment">// WM_TIMER</span></span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,   <span class="comment">// timer identifier</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam    <span class="comment">// timer callback (TIMERPROC)</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在回调函数中使用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_TIMER:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> nCount = <span class="number">0</span>;</span><br><span class="line">    nCount++;</span><br><span class="line">    wsprintf(szBuff, <span class="string">&quot;Timer: %d&quot;</span>, nCount);</span><br><span class="line">    OutputDebugString(szBuff);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="https://s1.ax1x.com/2020/09/19/w5E0Gd.png" alt="img"></p>
<h2 id="使用KillTimer函数关闭定时器"><a href="#使用KillTimer函数关闭定时器" class="headerlink" title="使用KillTimer函数关闭定时器"></a>使用KillTimer函数关闭定时器</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">KillTimer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hWnd,          <span class="comment">// 与指定计时器关联的窗口的句柄。</span></span></span></span><br><span class="line"><span class="function"><span class="params">    UINT_PTR uIDEvent   <span class="comment">// 定时器id</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<h1 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h1><p>微软提供了两个API让程序员可以手动向窗口发送消息</p>
<h2 id="使用PostMessage将消息投递到消息队列"><a href="#使用PostMessage将消息投递到消息队列" class="headerlink" title="使用PostMessage将消息投递到消息队列"></a>使用PostMessage将消息投递到消息队列</h2><p>函数定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CPP</span><br><span class="line">BOOL PostMessage(</span><br><span class="line">  HWND   hWnd,</span><br><span class="line">  UINT   Msg,</span><br><span class="line">  WPARAM wParam,</span><br><span class="line">  LPARAM lParam</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PostMessage(hWnd, WM_KEYDOWN, <span class="string">&#x27;a&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="使用SendMessage直接调用窗口过程函数"><a href="#使用SendMessage直接调用窗口过程函数" class="headerlink" title="使用SendMessage直接调用窗口过程函数"></a>使用SendMessage直接调用窗口过程函数</h2><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">SendMessage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND   hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">  UINT   Msg,</span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SendMessage(hWnd, WM_KEYDOWN, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h2 id="自定义消息"><a href="#自定义消息" class="headerlink" title="自定义消息"></a>自定义消息</h2><p>为了区分系统的消息和自定义的消息，windows提供了<strong>WM_USER</strong>宏。</p>
<p><img src="https://s1.ax1x.com/2020/09/21/wHYQiD.png" alt="img"></p>
<p>系统的消息都是在0x400以下，所以自定义消息，要在400以上，才不会和系统消息冲突。</p>
<p>demo：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置自定义消息</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_MYMSG WM_USER+1</span></span><br><span class="line"><span class="comment">//发送消息</span></span><br><span class="line">SendMessage(hWnd, WM_MYMSG, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//在窗口过程函数内处理消息</span></span><br><span class="line"><span class="keyword">case</span> WM_MYMSG:</span><br><span class="line">&#123;</span><br><span class="line">    MessageBox(hwnd, <span class="string">&quot;WM_MYMSG&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h1><p>在<code>右击项目-&gt;添加-&gt;资源</code> 中可以新建所需要的资源文件</p>
<p><img src="https://s1.ax1x.com/2020/09/19/w5VofH.png" alt="img"></p>
<h2 id="Icon图标资源"><a href="#Icon图标资源" class="headerlink" title="Icon图标资源"></a>Icon图标资源</h2><p><img src="https://s1.ax1x.com/2020/09/20/wTSX1x.png" alt="img"></p>
<h3 id="使用LoadIcon函数加载图标资源"><a href="#使用LoadIcon函数加载图标资源" class="headerlink" title="使用LoadIcon函数加载图标资源"></a>使用LoadIcon函数加载图标资源</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HICON <span class="title">LoadIconA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HINSTANCE hInstance, <span class="comment">//实例句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPCSTR    lpIconName <span class="comment">//图标名称</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>第二个参数<strong>lpIconName</strong>是指图标属性中的ID：<br><img src="https://s1.ax1x.com/2020/09/20/wTSO91.png" alt="img"></p>
<p>使用<strong>RegisterClass</strong>中的结构体加载Icon图标资源：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_ICON1);</span><br></pre></td></tr></table></figure>
<h2 id="Cursor光标资源"><a href="#Cursor光标资源" class="headerlink" title="Cursor光标资源"></a>Cursor光标资源</h2><p><a target="_blank" rel="noopener" href="https://s1.ax1x.com/2020/09/20/wTSjc6.png"><img src="https://s1.ax1x.com/2020/09/20/wTSjc6.png" alt="img"></a></p>
<h3 id="使用LoadCursor函数加载光标资源"><a href="#使用LoadCursor函数加载光标资源" class="headerlink" title="使用LoadCursor函数加载光标资源"></a>使用LoadCursor函数加载光标资源</h3><p>函数定义和icon一样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HCURSOR <span class="title">LoadCursor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">  LPCSTR    lpCursorName</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用<strong>RegisterClass</strong>中的结构体加载Cursor图标资源：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc.hCursor = LoadCursor(hInstance, MAKEINTRESOURCE(CUR_CUR1));</span><br></pre></td></tr></table></figure>
<h2 id="hbrBackground背景资源"><a href="#hbrBackground背景资源" class="headerlink" title="hbrBackground背景资源"></a>hbrBackground背景资源</h2><p>微软提供了一些预定义好的宏，需要注意的是官方文档中说明，在使用官方宏的时候需要在所选颜色上+1.</p>
<p>![img](<a target="_blank" rel="noopener" href="https://s1.ax1x.com/2020/09/20/wTSqhR.png">https://s1.ax1x.com/2020/09/20/wTSqhR.png</a></p>
<p>官方预定义好的背景宏：</p>
<ul>
<li>COLOR_ACTIVEBORDER</li>
<li>COLOR_ACTIVECAPTION</li>
<li>COLOR_APPWORKSPACE</li>
<li>COLOR_BACKGROUND</li>
<li>COLOR_BTNFACE</li>
<li>COLOR_BTNSHADOW</li>
<li>COLOR_BTNTEXT</li>
<li>COLOR_CAPTIONTEXT</li>
<li>COLOR_GRAYTEXT</li>
<li>COLOR_HIGHLIGHT</li>
<li>COLOR_HIGHLIGHTTEXT</li>
<li>COLOR_INACTIVEBORDER</li>
<li>COLOR_INACTIVECAPTION</li>
<li>COLOR_MENU</li>
<li>COLOR_MENUTEXT</li>
<li>COLOR_SCROLLBAR</li>
<li>COLOR_WINDOW</li>
<li>COLOR_WINDOWFRAME</li>
<li>COLOR_WINDOWTEXT</li>
</ul>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc.hbrBackground = (HBRUSH)(COLOR_ACTIVEBORDER + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Menu菜单资源"><a href="#Menu菜单资源" class="headerlink" title="Menu菜单资源"></a>Menu菜单资源</h2><p><img src="https://s1.ax1x.com/2020/09/20/wTSznO.png" alt="img"></p>
<h3 id="在类中绑定菜单"><a href="#在类中绑定菜单" class="headerlink" title="在类中绑定菜单"></a>在类中绑定菜单</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc.lpszMenuName = MAKEINTRESOURCE(MN_MN1);</span><br></pre></td></tr></table></figure>
<h3 id="创建窗口时使用LoadMenu绑定菜单"><a href="#创建窗口时使用LoadMenu绑定菜单" class="headerlink" title="创建窗口时使用LoadMenu绑定菜单"></a>创建窗口时使用LoadMenu绑定菜单</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HMENU <span class="title">LoadMenuA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">  LPCSTR    lpMenuName</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadMenu(hInstance, MAKEINTRESOURCE(MN_MN1));</span><br></pre></td></tr></table></figure>
<h3 id="菜单消息"><a href="#菜单消息" class="headerlink" title="菜单消息"></a>菜单消息</h3><p>使用<strong>WM_COMMAND</strong>来处理菜单消息。<br>需要注意的是<strong>WM_COMMAND</strong>并不单单处理菜单的消息，还会处理控件和快捷键的消息。</p>
<table>
<thead>
<tr>
<th>消息来源</th>
<th>wParam（高字）</th>
<th>wParam（低字）</th>
<th>lParam</th>
</tr>
</thead>
<tbody><tr>
<td>菜单</td>
<td>0</td>
<td>菜单标识符（IDM_ *）</td>
<td>0</td>
</tr>
<tr>
<td>快捷键</td>
<td>1</td>
<td>快捷键标识符（IDM_ *）</td>
<td>0</td>
</tr>
<tr>
<td>控件</td>
<td>控件定义的通知代码</td>
<td>控件标识符</td>
<td>Handle to the control window</td>
</tr>
</tbody></table>
<p>使用方法:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">    &#123;</span><br><span class="line">      WORD wFrom = HIWORD(wParam);<span class="comment">//取高位</span></span><br><span class="line">      WORD wID = LOWORD(wParam);<span class="comment">//取低位</span></span><br><span class="line">      <span class="keyword">if</span>(wFrom == <span class="number">0</span>)<span class="comment">//判断是否来自于菜单</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">switch</span>(wID)</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> MN_MENU1:</span><br><span class="line">          MessageBox(<span class="literal">NULL</span>, <span class="string">&quot;MENU1&quot;</span>, <span class="string">&quot;提示&quot;</span>, MB_OK);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> MN_MENU2:</span><br><span class="line">          MessageBox(<span class="literal">NULL</span>, <span class="string">&quot;MENU2&quot;</span>, <span class="string">&quot;提示&quot;</span>, MB_OK);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> MN_MENU3:</span><br><span class="line">          MessageBox(<span class="literal">NULL</span>, <span class="string">&quot;MENU3&quot;</span>, <span class="string">&quot;提示&quot;</span>, MB_OK);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Accelerator快捷键资源"><a href="#Accelerator快捷键资源" class="headerlink" title="Accelerator快捷键资源"></a>Accelerator快捷键资源</h2><p><img src="https://s1.ax1x.com/2020/09/20/wTSvjK.png" alt="img"></p>
<h3 id="设置快捷键"><a href="#设置快捷键" class="headerlink" title="设置快捷键"></a>设置快捷键</h3><p><img src="https://s1.ax1x.com/2020/09/20/wTpSBD.png" alt="img"></p>
<p>在“修饰符”处，选择快捷键。</p>
<p>在”键“处，设置按键，如果是字母按键直接输入即可。</p>
<h3 id="使用LoadAccelerators加载快捷键"><a href="#使用LoadAccelerators加载快捷键" class="headerlink" title="使用LoadAccelerators加载快捷键"></a>使用LoadAccelerators加载快捷键</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HACCEL <span class="title">LoadAcceleratorsA</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HINSTANCE hInstance,</span></span></span><br><span class="line"><span class="function"><span class="params">  LPCSTR    lpTableName</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HACCEL hAccel = LoadAccelerators(hInstance,MAKEINIRESOURCE(ACCEL_AC1));</span><br></pre></td></tr></table></figure>
<p>在消息循环中，使用<strong>TranslateAccelerator</strong>函数将按键消息转换成<strong>WM_COMMAND</strong>消息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将按键消息转换成快捷键消息</span></span><br><span class="line"><span class="keyword">if</span>(!TranslateAccelerator(hWnd, hAccel, &amp;msg))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//根据窗口调用对应的回调函数</span></span><br><span class="line">    DispatchMessage(&amp;msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="处理快捷键消息"><a href="#处理快捷键消息" class="headerlink" title="处理快捷键消息"></a>处理快捷键消息</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">    &#123;</span><br><span class="line">      WORD wFrom = HIWORD(wParam);<span class="comment">//取高位</span></span><br><span class="line">      WORD wID = LOWORD(wParam);<span class="comment">//取低位</span></span><br><span class="line">      <span class="keyword">if</span>(wFrom == <span class="number">1</span>)<span class="comment">//判断是否来自于菜单</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">switch</span>(wID)</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> CTRL_A:</span><br><span class="line">              MessageBox(<span class="literal">NULL</span>, <span class="string">&quot;CTRL_A&quot;</span>, <span class="string">&quot;提示&quot;</span>, MB_OK);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> SHIFT_B:</span><br><span class="line">              MessageBox(<span class="literal">NULL</span>, <span class="string">&quot;SHIFT_B&quot;</span>, <span class="string">&quot;提示&quot;</span>, MB_OK);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="对话框"><a href="#对话框" class="headerlink" title="对话框"></a>对话框</h1><p><img src="https://s1.ax1x.com/2020/09/21/wHs2in.png" alt="img"></p>
<h2 id="模态对话框（阻塞父窗口）"><a href="#模态对话框（阻塞父窗口）" class="headerlink" title="模态对话框（阻塞父窗口）"></a>模态对话框（阻塞父窗口）</h2><h3 id="创建模态对话框需要那些步骤？"><a href="#创建模态对话框需要那些步骤？" class="headerlink" title="创建模态对话框需要那些步骤？"></a>创建模态对话框需要那些步骤？</h3><ul>
<li>1.设计对话框资源模板</li>
<li>2.实现对话框过程函数</li>
<li>3.创建对话框</li>
</ul>
<h3 id="设计对话框资源模板"><a href="#设计对话框资源模板" class="headerlink" title="设计对话框资源模板"></a>设计对话框资源模板</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">资源视图&#96;-&gt;&#96;右键菜单&#96;-&gt;&#96;添加资源&#96;-&gt;&#96;Dialog</span><br></pre></td></tr></table></figure>
<h3 id="实现对话框过程函数"><a href="#实现对话框过程函数" class="headerlink" title="实现对话框过程函数"></a>实现对话框过程函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模态对话框过程函数</span></span><br><span class="line"><span class="function">INT_PTR CALLBACK <span class="title">DialogProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hwndDlg,  <span class="comment">// handle to dialog box</span></span></span></span><br><span class="line"><span class="function"><span class="params">    UINT uMsg,     <span class="comment">// message  </span></span></span></span><br><span class="line"><span class="function"><span class="params">    WPARAM wParam, <span class="comment">// first message parameter</span></span></span></span><br><span class="line"><span class="function"><span class="params">    LPARAM lParam  <span class="comment">// second message parameter</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用DialogBox创建对话框"><a href="#使用DialogBox创建对话框" class="headerlink" title="使用DialogBox创建对话框"></a>使用DialogBox创建对话框</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建对话框</span></span><br><span class="line">DialogBox(</span><br><span class="line">    GetModuleHandle(<span class="literal">NULL</span>), <span class="comment">//实例句柄</span></span><br><span class="line">    MAKEINTRESOURCE(IDD_DIALOG1),<span class="comment">//资源ID</span></span><br><span class="line">    hwnd,<span class="comment">//句柄</span></span><br><span class="line">    (DLGPROC)DialogProc<span class="comment">//模态对话框过程函数</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="使用EndDialog销毁模态对话框"><a href="#使用EndDialog销毁模态对话框" class="headerlink" title="使用EndDialog销毁模态对话框"></a>使用EndDialog销毁模态对话框</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">EndDialog</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND    hDlg,</span></span></span><br><span class="line"><span class="function"><span class="params">  INT_PTR nResult</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EndDialog(hwndDlg, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<h3 id="完整代码-2"><a href="#完整代码-2" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模态对话框过程函数</span></span><br><span class="line"><span class="function">INT_PTR CALLBACK <span class="title">DialogProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND hwndDlg,  <span class="comment">// handle to dialog box</span></span></span></span><br><span class="line"><span class="function"><span class="params">    UINT uMsg,     <span class="comment">// message  </span></span></span></span><br><span class="line"><span class="function"><span class="params">    WPARAM wParam, <span class="comment">// first message parameter</span></span></span></span><br><span class="line"><span class="function"><span class="params">    LPARAM lParam  <span class="comment">// second message parameter</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//向消息队列中投递一个WM_QUIT消息用来结束消息循环。</span></span><br><span class="line">        <span class="comment">//此处不能使用DestroyWindow销毁模态对话框</span></span><br><span class="line">        EndDialog(hwndDlg, <span class="literal">NULL</span>);<span class="comment">//Dialog对话框需要使用EndDialog来销毁</span></span><br><span class="line">        <span class="keyword">return</span> TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建对话框</span></span><br><span class="line">DialogBox(</span><br><span class="line">    GetModuleHandle(<span class="literal">NULL</span>), <span class="comment">//实例句柄</span></span><br><span class="line">    MAKEINTRESOURCE(IDD_DIALOG1),<span class="comment">//资源ID</span></span><br><span class="line">    hwnd,<span class="comment">//句柄</span></span><br><span class="line">    (DLGPROC)DialogProc<span class="comment">//模态对话框过程函数</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>详细信息可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/dlgbox/dialog-box-functions">Dialog Box Functions]</a></p>
<h3 id="模态对话框阻塞夫窗口的原因"><a href="#模态对话框阻塞夫窗口的原因" class="headerlink" title="模态对话框阻塞夫窗口的原因"></a>模态对话框阻塞夫窗口的原因</h3><ul>
<li><ol>
<li>内部自建消息循环</li>
</ol>
</li>
<li><ol>
<li>内部调用EnableWindow(禁用鼠标和键盘输入到指定的窗口或控件)</li>
</ol>
</li>
</ul>
<h3 id="取消对父窗口的禁用"><a href="#取消对父窗口的禁用" class="headerlink" title="取消对父窗口的禁用"></a>取消对父窗口的禁用</h3><p>使用WM_INITDIALOG消息让对话框在初始化的时候取消对父窗口的禁用。</p>
<p>WM_INITDIALOG的定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hwnd,       <span class="comment">// handle to window</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT uMsg,       <span class="comment">// WM_INITDIALOG</span></span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,   <span class="comment">// handle to control (HWND) 窗口句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam    <span class="comment">// 调用对话框时，设置为NULL</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>EnableWindow的定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">EnableWindow</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">  BOOL bEnable</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>完整代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_INITDIALOG:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hParent = GetParent(hwndDlg);<span class="comment">//给予子窗口句柄返回父窗口</span></span><br><span class="line">    EnableWindow(hParent, TRUE);<span class="comment">//允许父窗口接收键盘和鼠标输入</span></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>EnableWindow</strong>设置<strong>True</strong>后，在模态对话框运行时，父窗口仍然可以接收鼠标和键盘的消息。</p>
<h2 id="非模态对话框（不阻塞父窗口）"><a href="#非模态对话框（不阻塞父窗口）" class="headerlink" title="非模态对话框（不阻塞父窗口）"></a>非模态对话框（不阻塞父窗口）</h2><h3 id="使用CreateDialog创建非模态对话框"><a href="#使用CreateDialog创建非模态对话框" class="headerlink" title="使用CreateDialog创建非模态对话框"></a>使用CreateDialog创建非模态对话框</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateDialog</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   hInstance,		<span class="comment">//实例句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">   lpName,			<span class="comment">//资源ID</span></span></span></span><br><span class="line"><span class="function"><span class="params">   hWndParent,		<span class="comment">//hwnd</span></span></span></span><br><span class="line"><span class="function"><span class="params">   lpDialogFunc		<span class="comment">//对话框过程函数</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HWND hWnd = CreateDialog(GetModuleHandle(<span class="literal">NULL</span>),MAKEINTRESOURCE(DLG_TEXT),hwnd,(DLGPROC)DialogProc);</span><br></pre></td></tr></table></figure>
<h3 id="使用ShowWindow-显示非模态对话框"><a href="#使用ShowWindow-显示非模态对话框" class="headerlink" title="使用ShowWindow 显示非模态对话框"></a>使用ShowWindow 显示非模态对话框</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShowWindow(hWnd,SW_SHOW);</span><br></pre></td></tr></table></figure>
<h3 id="使用DestroyWindow销毁非模态对话框"><a href="#使用DestroyWindow销毁非模态对话框" class="headerlink" title="使用DestroyWindow销毁非模态对话框"></a>使用DestroyWindow销毁非模态对话框</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DestroyWindow(hwndDlg);</span><br></pre></td></tr></table></figure>
<h1 id="控件"><a href="#控件" class="headerlink" title="控件"></a>控件</h1><p>控件是微软封装好的一个个窗口</p>
<p>详细信息可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/controls/individual-control-info">Control Library]</a></p>
<h2 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h2><p>前缀以N结尾的消息，当按钮状态发生改变时进行告知。</p>
<p>前缀以M结尾的消息，对按钮做操作。</p>
<h3 id="处理按钮按下消息BN-CLICKED"><a href="#处理按钮按下消息BN-CLICKED" class="headerlink" title="处理按钮按下消息BN_CLICKED"></a>处理按钮按下消息BN_CLICKED</h3><p>BN_CLICKED的定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT CALLBACK <span class="title">WindowProc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hwnd,       <span class="comment">// handle to window</span></span></span></span><br><span class="line"><span class="function"><span class="params">  UINT uMsg,       <span class="comment">// WM_COMMAND</span></span></span></span><br><span class="line"><span class="function"><span class="params">  WPARAM wParam,   <span class="comment">// identifier of button, BN_CLICKED//按钮的Id</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LPARAM lParam    <span class="comment">// handle to button (HWND)//为按钮的句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>wParam高位是消息的ID，底位是控件的ID。</p>
<p>在WM_COMMAND中处理BN_CLICKED：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">&#123;</span><br><span class="line">    WORD wMessage = HIWORD(wParam);<span class="comment">//控件消息</span></span><br><span class="line">    WORD wControlId = LOWORD(wParam);<span class="comment">//控件的Id</span></span><br><span class="line">    <span class="keyword">switch</span> (wMessage)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> BN_CLICKED:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (wControlId)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> IDC_BUTTON_TEST:</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox(hwndDlg, <span class="string">&quot;按钮点击&quot;</span>, <span class="literal">NULL</span>, MB_OK);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> IDC_BUTTON_TEST2:</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox(hwndDlg, <span class="string">&quot;按钮点击2&quot;</span>, <span class="literal">NULL</span>, MB_OK);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="BM-CLICK模拟鼠标点击"><a href="#BM-CLICK模拟鼠标点击" class="headerlink" title="BM_CLICK模拟鼠标点击"></a>BM_CLICK模拟鼠标点击</h3><p>使用<code>GetDlgItem</code>拿到对话框中控件的窗口句柄。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IDC_BUTTON_SEND:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获取按钮的窗口句柄</span></span><br><span class="line">    HWND hBtn2 = GetDlgItem(hwndDlg,IDC_BUTTON_TEST2);</span><br><span class="line">    <span class="comment">//向按钮发送消息，模拟鼠标点击</span></span><br><span class="line">    SendMessage(hBtn2, BM_CLICK, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文本编辑框"><a href="#文本编辑框" class="headerlink" title="文本编辑框"></a>文本编辑框</h2><h3 id="获取编辑框内容"><a href="#获取编辑框内容" class="headerlink" title="获取编辑框内容"></a>获取编辑框内容</h3><p>使用<code>GetLine</code>按行获取文本内容。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> BTN_GETTEXT:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hEdit = GetDlgItem(hwndDlg, IDC_EDIT_TEST);</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="comment">//缓冲区第一个字的内容，为缓冲区的大小</span></span><br><span class="line">    *(WORD *)szBuff = <span class="keyword">sizeof</span>(szBuff);</span><br><span class="line">    SendMessage(hEdit, EM_GETLINE, <span class="number">0</span> , (LPARAM)szBuff);</span><br><span class="line">    MessageBox(hwndDlg, szBuff, <span class="string">&quot;编辑框内容&quot;</span>, MB_OK);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>WM_GETTEXT</code>获取本文内容(可以用来获取控件标题)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> BTN_GETTEXT:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hEdit = GetDlgItem(hwndDlg, IDC_EDIT_TEST);</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    SendMessage(hEdit, WM_GETTEXT, <span class="keyword">sizeof</span>(szBuff), (LPARAM)szBuff);</span><br><span class="line">    MessageBox(hwndDlg, szBuff, <span class="string">&quot;编辑框内容&quot;</span>, MB_OK);</span><br><span class="line">    <span class="keyword">break</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>GetWindowText</code>获取文本编辑框内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> BTN_GETTEXT:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hEdit = GetDlgItem(hwndDlg, IDC_EDIT_TEST);</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    GetWindowText(hEdit, szBuff, <span class="keyword">sizeof</span>(szBuff));</span><br><span class="line">    MessageBox(hwndDlg, szBuff, <span class="string">&quot;编辑框内容&quot;</span>, MB_OK);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>GetDlgItemText</code>获取文本编辑框内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> BTN_GETTEXT:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    GetDlgItemText(hwndDlg, IDC_EDIT_TEST, szBuff, <span class="keyword">sizeof</span>(szBuff));</span><br><span class="line">    MessageBox(hwndDlg, szBuff, <span class="string">&quot;编辑框内容&quot;</span>, MB_OK);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>如要设置设置编辑框文本内容，将上面GET改为SET即可</strong></p>
<h2 id="列表框"><a href="#列表框" class="headerlink" title="列表框"></a>列表框</h2><h3 id="关闭列表框自动排序功能。"><a href="#关闭列表框自动排序功能。" class="headerlink" title="关闭列表框自动排序功能。"></a>关闭列表框自动排序功能。</h3><p><img src="https://s1.ax1x.com/2020/09/21/wHYAz9.png" alt="img"></p>
<h3 id="使用LB-ADDSTRING添加值"><a href="#使用LB-ADDSTRING添加值" class="headerlink" title="使用LB_ADDSTRING添加值"></a>使用LB_ADDSTRING添加值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IDC_BUTTON_ADD:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    GetDlgItemText(hwndDlg, IDC_EDIT1, szBuff, <span class="keyword">sizeof</span>(szBuff));</span><br><span class="line">    HWND hLstb = GetDlgItem(hwndDlg, IDC_LIST_TEXT);</span><br><span class="line">    SendMessage(hLstb, LB_ADDSTRING, <span class="number">0</span>, (LPARAM)szBuff);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用LB-GETCURSEL获取当前选中项的索引值"><a href="#使用LB-GETCURSEL获取当前选中项的索引值" class="headerlink" title="使用LB_GETCURSEL获取当前选中项的索引值"></a>使用LB_GETCURSEL获取当前选中项的索引值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HWND hLstb = GetDlgItem(hwndDlg, IDC_LIST_TEXT);</span><br><span class="line"><span class="comment">//获取被选中的索引值</span></span><br><span class="line"><span class="keyword">int</span> nIndex = SendMessage(hLstb, LB_GETCURSEL, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="使用LB-DELETESTRING删除值"><a href="#使用LB-DELETESTRING删除值" class="headerlink" title="使用LB_DELETESTRING删除值"></a>使用LB_DELETESTRING删除值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IDC_BUTTON_DEL:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hLstb = GetDlgItem(hwndDlg, IDC_LIST_TEXT);</span><br><span class="line">    <span class="comment">//获取被选中的索引值</span></span><br><span class="line">    <span class="keyword">int</span> nIndex = SendMessage(hLstb, LB_GETCURSEL, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除被选中的项</span></span><br><span class="line">    SendMessage(hLstb, LB_DELETESTRING, nIndex, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用LB-GETTEXT获取内容"><a href="#使用LB-GETTEXT获取内容" class="headerlink" title="使用LB_GETTEXT获取内容"></a>使用LB_GETTEXT获取内容</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IDC_BUTTON_GET:</span><br><span class="line">&#123;</span><br><span class="line">    HWND hLstb = GetDlgItem(hwndDlg, IDC_LIST_TEXT);</span><br><span class="line">    <span class="comment">//获取被选中的索引值</span></span><br><span class="line">    <span class="keyword">int</span> nIndex = SendMessage(hLstb, LB_GETCURSEL, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//获取字符串</span></span><br><span class="line">    <span class="keyword">char</span> szBuff[MAXBYTE] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    SendMessage(hLstb, LB_GETTEXT, nIndex, (LPARAM)szBuff);</span><br><span class="line">    MessageBox(<span class="literal">NULL</span>, szBuff, <span class="literal">NULL</span>, MB_OK);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>详细信息可以查看官方文档☛[<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/controls/bumper-list-box-control-reference-messages">List Box Messages]</a></p>
<h1 id="子类化"><a href="#子类化" class="headerlink" title="子类化"></a>子类化</h1><h2 id="什么是子类化？"><a href="#什么是子类化？" class="headerlink" title="什么是子类化？"></a>什么是子类化？</h2><p>在很多情况下，官方所封装好的控件功能并不能满足软件功能的需求，这时候就需要用到<strong>子类化</strong>技术，给控件添加我们自己所需要的功能。子类化允许你接管被子类化的窗口，使你对它有绝对的控制权。</p>
<h2 id="实现自己需要的窗口过程函数"><a href="#实现自己需要的窗口过程函数" class="headerlink" title="实现自己需要的窗口过程函数"></a>实现自己需要的窗口过程函数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//g_pfnOldEditProc需要定义成全局的 否则MyEditProc无法获取</span></span><br><span class="line">WNDPROC g_pfnOldEditProc = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">MyEditProc</span><span class="params">(HWND hEdit,UINT message,WPARAM wParam,LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(message == WM_CHAR)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(</span><br><span class="line">            ((<span class="string">&#x27;0&#x27;</span> &lt;= wParam) &amp;&amp; (wParam &lt;= <span class="string">&#x27;9&#x27;</span>)) ||</span><br><span class="line">            ((<span class="string">&#x27;a&#x27;</span> &lt;= wParam) &amp;&amp; (wParam &lt;= <span class="string">&#x27;z&#x27;</span>)) ||</span><br><span class="line">            ((<span class="string">&#x27;A&#x27;</span> &lt;= wParam) &amp;&amp; (wParam &lt;= <span class="string">&#x27;Z&#x27;</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//交给原来的窗口过程函数显示</span></span><br><span class="line">            <span class="keyword">return</span> g_pfnOldEditProc(hEdit,message,wParam,lParam);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//不显示</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//其他消息依旧交给原来的窗口过程函数显示</span></span><br><span class="line">    <span class="keyword">return</span> g_pfnOldEditProc(hEdit,message,wParam,lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用SetWindowLong实现子类化"><a href="#使用SetWindowLong实现子类化" class="headerlink" title="使用SetWindowLong实现子类化"></a>使用SetWindowLong实现子类化</h2><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG <span class="title">SetWindowLong</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd,		<span class="comment">//窗口的句柄</span></span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span>  nIndex,		<span class="comment">//从零开始的要设置值的偏移量</span></span></span></span><br><span class="line"><span class="function"><span class="params">  LONG dwNewLong	<span class="comment">//替换值。</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取需要子类化的控件的句柄</span></span><br><span class="line">HWND hEdit = GetDlgItem(hDlg,EDT_SUBCALSS);</span><br><span class="line"><span class="comment">//保存原来的窗口过程函数</span></span><br><span class="line">g_pfnOldEditProc = (WNDPROC)GetWindowLong(hEdit,GWL_WNDPROC);</span><br><span class="line"><span class="comment">//设置新的窗口过程函数</span></span><br><span class="line">SetWindowLong(hEdit,GWL_WNDPROC,(LONG)MyEditProc);</span><br></pre></td></tr></table></figure>
<h2 id="一个bug"><a href="#一个bug" class="headerlink" title="一个bug"></a>一个bug</h2><p>如果在进行子类化之后再次进行子类化，那么第二次子类化<strong>GetWindowLong</strong>获取到的就是我们自己设计的窗口过程函数的地址，造成递归死循环，所以在<strong>GetWindowLong</strong>处需要做一下判断，判断是否为我们自己的窗口过程函数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取需要子类化的控件的句柄</span></span><br><span class="line">HWND hEdit = GetDlgItem(hDlg,EDT_SUBCALSS);</span><br><span class="line"><span class="comment">//判断GetWindowLong</span></span><br><span class="line"><span class="keyword">if</span> (g_pfnOldEditProc == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//保存原来的窗口过程函数</span></span><br><span class="line">    g_pfnOldEditProc = (WNDPROC)GetWindowLong(hEdit,GWL_WNDPROC);</span><br><span class="line">    <span class="comment">//设置新的窗口过程函数</span></span><br><span class="line">    SetWindowLong(hEdit,GWL_WNDPROC,(LONG)MyEditProc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用SetClassLong子类化"><a href="#使用SetClassLong子类化" class="headerlink" title="使用SetClassLong子类化"></a>使用SetClassLong子类化</h2><p><strong>SetClassLong</strong>与<strong>SetWindowLong</strong>的区别在于，SetWindowLong会马上将窗口进行子类化，而SetClassLolng则会将窗口类的属性进行修改，这样只会影响到新创建的窗口，并不会影响当前已经创建好的窗口。</p>
<p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">DWORD <span class="title">SetClassLong</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  HWND hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">int</span>  nIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">  LONG dwNewLong</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法与SetWindowLong一致：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HWND hEdit = GetDlgItem(hDlg,EDT_SUBCALSS);</span><br><span class="line"><span class="keyword">if</span> (g_pfnOldEditProc == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    g_pfnOldEditProc = (WNDPROC)GetClassLong(hEdit,GWL_WNDPROC);</span><br><span class="line">    SetClassLong(hEdit,GWL_WNDPROC,(LONG)MyEditProc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="查看SDK错误信息"><a href="#查看SDK错误信息" class="headerlink" title="查看SDK错误信息"></a>查看SDK错误信息</h2><h3 id="使用GetLastError获取API失败的信息"><a href="#使用GetLastError获取API失败的信息" class="headerlink" title="使用GetLastError获取API失败的信息"></a>使用GetLastError获取API失败的信息</h3><p>函数定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_Post_equals_last_error_ DWORD <span class="title">GetLastError</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DWORD dwErr = GetLastError();</span><br></pre></td></tr></table></figure>
<p>返回的错误码可以在VS中的<strong>错误查找</strong>中查询：</p>
<p><img src="https://s1.ax1x.com/2020/09/23/wjr52d.png" alt="img"></p>
<h3 id="使用FormatMessage将错误码转换为错误信息"><a href="#使用FormatMessage将错误码转换为错误信息" class="headerlink" title="使用FormatMessage将错误码转换为错误信息"></a>使用FormatMessage将错误码转换为错误信息</h3><p>封装函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//显示错误信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShowErrorMsg</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LPVOID lpMsgBuf;</span><br><span class="line">    FormatMessage(</span><br><span class="line">        FORMAT_MESSAGE_ALLOCATE_BUFFER |</span><br><span class="line">        FORMAT_MESSAGE_FROM_SYSTEM |</span><br><span class="line">        FORMAT_MESSAGE_IGNORE_INSERTS,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        GetLastError(),</span><br><span class="line">        MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), <span class="comment">// Default language</span></span><br><span class="line">        (LPTSTR)&amp;lpMsgBuf,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="literal">NULL</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//弹窗显示错误信息</span></span><br><span class="line">    MessageBox(<span class="literal">NULL</span>, (LPCTSTR)lpMsgBuf, TEXT(<span class="string">&quot;Error&quot;</span>), MB_OK | MB_ICONINFORMATION);</span><br><span class="line">    <span class="comment">//释放</span></span><br><span class="line">    LocalFree(lpMsgBuf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="直接在监视窗口中查看错误信息"><a href="#直接在监视窗口中查看错误信息" class="headerlink" title="直接在监视窗口中查看错误信息"></a>直接在监视窗口中查看错误信息</h3><ul>
<li>1.VS：<code>@err,hr</code></li>
<li>2.VC6.0：<code>*(unsigned long*)(tib+0x34),hr</code></li>
<li>3.直接<code>错误码,hr</code></li>
</ul>
<p><img src="https://s1.ax1x.com/2020/09/23/wjrIxA.png" alt="img"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ZDDR</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zddr.net/2020/09/15/Windows%20SDK/">https://zddr.net/2020/09/15/Windows SDK/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zddr.net" target="_blank">ZDDR's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/09/17/wWSbKs.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/10/12/x86%E5%86%85%E6%A0%B8-%E4%BF%9D%E6%8A%A4%E6%A8%A1%E5%BC%8F--%E6%AE%B5/"><img class="prev-cover" src="https://s2.ax1x.com/2020/02/11/1oFBM8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">x86内核-保护模式--段</div></div></a></div><div class="next-post pull-right"><a href="/2020/09/06/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><img class="next-cover" src="https://s1.ax1x.com/2020/09/07/wmRb3d.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据结构</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">创建一个窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3%E9%9C%80%E8%A6%81%E9%82%A3%E4%BA%9B%E6%AD%A5%E9%AA%A4%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">创建窗口需要那些步骤？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8RegisterClass%E6%B3%A8%E5%86%8C%E7%AA%97%E5%8F%A3%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">使用RegisterClass注册窗口类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8CreateWindow%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.3.</span> <span class="toc-text">使用CreateWindow创建窗口实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ShowWindow%E6%98%BE%E7%A4%BA%E7%AA%97%E5%8F%A3"><span class="toc-number">1.4.</span> <span class="toc-text">使用ShowWindow显示窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8UpdateWindow%E6%9B%B4%E6%96%B0%E7%AA%97%E5%8F%A3"><span class="toc-number">1.5.</span> <span class="toc-text">使用UpdateWindow更新窗口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%B6%88%E6%81%AF%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.6.</span> <span class="toc-text">建立消息循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.</span> <span class="toc-text">实现窗口过程函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E9%94%80%E6%AF%81"><span class="toc-number">1.8.</span> <span class="toc-text">窗口销毁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">1.9.</span> <span class="toc-text">完整代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%98%E5%9B%BE%E6%B6%88%E6%81%AF"><span class="toc-number">2.</span> <span class="toc-text">绘图消息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%98%E5%9B%BE%E6%B6%88%E6%81%AF%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">什么是绘图消息？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E6%95%88%E5%8C%BA%EF%BC%9F"><span class="toc-number">2.2.</span> <span class="toc-text">什么是无效区？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WM-PAINT%E6%B6%88%E6%81%AF%E5%AE%9A%E4%B9%89"><span class="toc-number">2.3.</span> <span class="toc-text">WM_PAINT消息定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8DrawText%E5%87%BD%E6%95%B0%E7%BB%98%E5%88%B6%E6%96%87%E6%9C%AC"><span class="toc-number">2.4.</span> <span class="toc-text">使用DrawText函数绘制文本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8BeginPaint%E8%8E%B7%E5%8F%96DC"><span class="toc-number">2.5.</span> <span class="toc-text">使用BeginPaint获取DC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8EndPaint%E9%87%8A%E6%94%BEDC"><span class="toc-number">2.6.</span> <span class="toc-text">使用EndPaint释放DC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-1"><span class="toc-number">2.7.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E7%B3%BB%E7%BB%9F%E4%B8%8D%E5%8F%91%E9%80%81WM-PAINT%E6%B6%88%E6%81%AF%E6%97%B6%E7%BB%98%E5%9B%BE"><span class="toc-number">2.8.</span> <span class="toc-text">在系统不发送WM_PAINT消息时绘图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8InvalidateRect%E5%87%BD%E6%95%B0%E6%89%8B%E5%8A%A8%E5%8F%91%E9%80%81WM-PAINT%E6%B6%88%E6%81%AF"><span class="toc-number">2.8.1.</span> <span class="toc-text">使用InvalidateRect函数手动发送WM_PAINT消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8GetDC%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.2.</span> <span class="toc-text">使用GetDC函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BeginPaint%E5%92%8CGetDC%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.9.</span> <span class="toc-text">BeginPaint和GetDC的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E6%B6%88%E6%81%AF"><span class="toc-number">3.</span> <span class="toc-text">键盘消息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WM-KEYDOWN%E4%BF%A1%E6%81%AF"><span class="toc-number">3.1.</span> <span class="toc-text">WM_KEYDOWN信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WM-CHAR%E6%B6%88%E6%81%AF"><span class="toc-number">3.2.</span> <span class="toc-text">WM_CHAR消息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8WM-CHAR%E5%A4%84%E7%90%86%E4%B8%AD%E6%96%87"><span class="toc-number">3.3.</span> <span class="toc-text">使用WM_CHAR处理中文</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E6%B6%88%E6%81%AF"><span class="toc-number">4.</span> <span class="toc-text">鼠标消息</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E5%99%A8%E6%B6%88%E6%81%AF"><span class="toc-number">5.</span> <span class="toc-text">定时器消息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SetTimer%E5%87%BD%E6%95%B0%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">使用SetTimer函数设置定时器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WM-TIMER%E6%B6%88%E6%81%AF"><span class="toc-number">5.2.</span> <span class="toc-text">WM_TIMER消息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8KillTimer%E5%87%BD%E6%95%B0%E5%85%B3%E9%97%AD%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">使用KillTimer函数关闭定时器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="toc-number">6.</span> <span class="toc-text">发送消息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8PostMessage%E5%B0%86%E6%B6%88%E6%81%AF%E6%8A%95%E9%80%92%E5%88%B0%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">6.1.</span> <span class="toc-text">使用PostMessage将消息投递到消息队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SendMessage%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">使用SendMessage直接调用窗口过程函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF"><span class="toc-number">6.3.</span> <span class="toc-text">自定义消息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-number">7.</span> <span class="toc-text">资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Icon%E5%9B%BE%E6%A0%87%E8%B5%84%E6%BA%90"><span class="toc-number">7.1.</span> <span class="toc-text">Icon图标资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LoadIcon%E5%87%BD%E6%95%B0%E5%8A%A0%E8%BD%BD%E5%9B%BE%E6%A0%87%E8%B5%84%E6%BA%90"><span class="toc-number">7.1.1.</span> <span class="toc-text">使用LoadIcon函数加载图标资源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cursor%E5%85%89%E6%A0%87%E8%B5%84%E6%BA%90"><span class="toc-number">7.2.</span> <span class="toc-text">Cursor光标资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LoadCursor%E5%87%BD%E6%95%B0%E5%8A%A0%E8%BD%BD%E5%85%89%E6%A0%87%E8%B5%84%E6%BA%90"><span class="toc-number">7.2.1.</span> <span class="toc-text">使用LoadCursor函数加载光标资源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hbrBackground%E8%83%8C%E6%99%AF%E8%B5%84%E6%BA%90"><span class="toc-number">7.3.</span> <span class="toc-text">hbrBackground背景资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Menu%E8%8F%9C%E5%8D%95%E8%B5%84%E6%BA%90"><span class="toc-number">7.4.</span> <span class="toc-text">Menu菜单资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%B1%BB%E4%B8%AD%E7%BB%91%E5%AE%9A%E8%8F%9C%E5%8D%95"><span class="toc-number">7.4.1.</span> <span class="toc-text">在类中绑定菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AA%97%E5%8F%A3%E6%97%B6%E4%BD%BF%E7%94%A8LoadMenu%E7%BB%91%E5%AE%9A%E8%8F%9C%E5%8D%95"><span class="toc-number">7.4.2.</span> <span class="toc-text">创建窗口时使用LoadMenu绑定菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E6%B6%88%E6%81%AF"><span class="toc-number">7.4.3.</span> <span class="toc-text">菜单消息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Accelerator%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%B5%84%E6%BA%90"><span class="toc-number">7.5.</span> <span class="toc-text">Accelerator快捷键资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">7.5.1.</span> <span class="toc-text">设置快捷键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LoadAccelerators%E5%8A%A0%E8%BD%BD%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-number">7.5.2.</span> <span class="toc-text">使用LoadAccelerators加载快捷键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%B6%88%E6%81%AF"><span class="toc-number">7.5.3.</span> <span class="toc-text">处理快捷键消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.</span> <span class="toc-text">对话框</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%EF%BC%88%E9%98%BB%E5%A1%9E%E7%88%B6%E7%AA%97%E5%8F%A3%EF%BC%89"><span class="toc-number">8.1.</span> <span class="toc-text">模态对话框（阻塞父窗口）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%E9%9C%80%E8%A6%81%E9%82%A3%E4%BA%9B%E6%AD%A5%E9%AA%A4%EF%BC%9F"><span class="toc-number">8.1.1.</span> <span class="toc-text">创建模态对话框需要那些步骤？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%B5%84%E6%BA%90%E6%A8%A1%E6%9D%BF"><span class="toc-number">8.1.2.</span> <span class="toc-text">设计对话框资源模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.3.</span> <span class="toc-text">实现对话框过程函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8DialogBox%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.1.4.</span> <span class="toc-text">使用DialogBox创建对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8EndDialog%E9%94%80%E6%AF%81%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.1.5.</span> <span class="toc-text">使用EndDialog销毁模态对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-2"><span class="toc-number">8.1.6.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%E9%98%BB%E5%A1%9E%E5%A4%AB%E7%AA%97%E5%8F%A3%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">8.1.7.</span> <span class="toc-text">模态对话框阻塞夫窗口的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E5%AF%B9%E7%88%B6%E7%AA%97%E5%8F%A3%E7%9A%84%E7%A6%81%E7%94%A8"><span class="toc-number">8.1.8.</span> <span class="toc-text">取消对父窗口的禁用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%EF%BC%88%E4%B8%8D%E9%98%BB%E5%A1%9E%E7%88%B6%E7%AA%97%E5%8F%A3%EF%BC%89"><span class="toc-number">8.2.</span> <span class="toc-text">非模态对话框（不阻塞父窗口）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8CreateDialog%E5%88%9B%E5%BB%BA%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.2.1.</span> <span class="toc-text">使用CreateDialog创建非模态对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ShowWindow-%E6%98%BE%E7%A4%BA%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.2.2.</span> <span class="toc-text">使用ShowWindow 显示非模态对话框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8DestroyWindow%E9%94%80%E6%AF%81%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">8.2.3.</span> <span class="toc-text">使用DestroyWindow销毁非模态对话框</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A7%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">控件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%92%AE"><span class="toc-number">9.1.</span> <span class="toc-text">按钮</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%8C%89%E9%92%AE%E6%8C%89%E4%B8%8B%E6%B6%88%E6%81%AFBN-CLICKED"><span class="toc-number">9.1.1.</span> <span class="toc-text">处理按钮按下消息BN_CLICKED</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BM-CLICK%E6%A8%A1%E6%8B%9F%E9%BC%A0%E6%A0%87%E7%82%B9%E5%87%BB"><span class="toc-number">9.1.2.</span> <span class="toc-text">BM_CLICK模拟鼠标点击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E6%A1%86"><span class="toc-number">9.2.</span> <span class="toc-text">文本编辑框</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BC%96%E8%BE%91%E6%A1%86%E5%86%85%E5%AE%B9"><span class="toc-number">9.2.1.</span> <span class="toc-text">获取编辑框内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%A1%86"><span class="toc-number">9.3.</span> <span class="toc-text">列表框</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E5%88%97%E8%A1%A8%E6%A1%86%E8%87%AA%E5%8A%A8%E6%8E%92%E5%BA%8F%E5%8A%9F%E8%83%BD%E3%80%82"><span class="toc-number">9.3.1.</span> <span class="toc-text">关闭列表框自动排序功能。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LB-ADDSTRING%E6%B7%BB%E5%8A%A0%E5%80%BC"><span class="toc-number">9.3.2.</span> <span class="toc-text">使用LB_ADDSTRING添加值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LB-GETCURSEL%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E9%80%89%E4%B8%AD%E9%A1%B9%E7%9A%84%E7%B4%A2%E5%BC%95%E5%80%BC"><span class="toc-number">9.3.3.</span> <span class="toc-text">使用LB_GETCURSEL获取当前选中项的索引值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LB-DELETESTRING%E5%88%A0%E9%99%A4%E5%80%BC"><span class="toc-number">9.3.4.</span> <span class="toc-text">使用LB_DELETESTRING删除值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LB-GETTEXT%E8%8E%B7%E5%8F%96%E5%86%85%E5%AE%B9"><span class="toc-number">9.3.5.</span> <span class="toc-text">使用LB_GETTEXT获取内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%90%E7%B1%BB%E5%8C%96"><span class="toc-number">10.</span> <span class="toc-text">子类化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%90%E7%B1%BB%E5%8C%96%EF%BC%9F"><span class="toc-number">10.1.</span> <span class="toc-text">什么是子类化？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E9%9C%80%E8%A6%81%E7%9A%84%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.</span> <span class="toc-text">实现自己需要的窗口过程函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SetWindowLong%E5%AE%9E%E7%8E%B0%E5%AD%90%E7%B1%BB%E5%8C%96"><span class="toc-number">10.3.</span> <span class="toc-text">使用SetWindowLong实现子类化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AAbug"><span class="toc-number">10.4.</span> <span class="toc-text">一个bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SetClassLong%E5%AD%90%E7%B1%BB%E5%8C%96"><span class="toc-number">10.5.</span> <span class="toc-text">使用SetClassLong子类化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">11.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BSDK%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">11.1.</span> <span class="toc-text">查看SDK错误信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8GetLastError%E8%8E%B7%E5%8F%96API%E5%A4%B1%E8%B4%A5%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">11.1.1.</span> <span class="toc-text">使用GetLastError获取API失败的信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8FormatMessage%E5%B0%86%E9%94%99%E8%AF%AF%E7%A0%81%E8%BD%AC%E6%8D%A2%E4%B8%BA%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">11.1.2.</span> <span class="toc-text">使用FormatMessage将错误码转换为错误信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%9C%A8%E7%9B%91%E8%A7%86%E7%AA%97%E5%8F%A3%E4%B8%AD%E6%9F%A5%E7%9C%8B%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">11.1.3.</span> <span class="toc-text">直接在监视窗口中查看错误信息</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(https://s1.ax1x.com/2020/09/17/wWSbKs.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By ZDDR</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>