<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Windows编程小记 | ZDDR's blog</title><meta name="keywords" content="ZDDR,逆向,内核,Pwn"><meta name="author" content="ZDDR"><meta name="copyright" content="ZDDR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="DLL123456789101112131415161718192021222324252627#include &quot;stdafx.h&quot;BOOL APIENTRY DllMain(	HMODULE hModule,	&#x2F;&#x2F;DLL模块的句柄 handle Module	DWORD ul_reason_for_call	&#x2F;&#x2F;DLLMain函数被调用的原因	LPVOID lpReserv">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows编程小记">
<meta property="og:url" content="https://zddr.net/2020/02/29/Windows%E7%BC%96%E7%A8%8B%E5%B0%8F%E8%AE%B0/index.html">
<meta property="og:site_name" content="ZDDR&#39;s blog">
<meta property="og:description" content="DLL123456789101112131415161718192021222324252627#include &quot;stdafx.h&quot;BOOL APIENTRY DllMain(	HMODULE hModule,	&#x2F;&#x2F;DLL模块的句柄 handle Module	DWORD ul_reason_for_call	&#x2F;&#x2F;DLLMain函数被调用的原因	LPVOID lpReserv">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.ax1x.com/2020/01/03/lNWQhD.jpg">
<meta property="article:published_time" content="2020-02-28T16:00:00.000Z">
<meta property="article:modified_time" content="2020-09-06T16:00:00.000Z">
<meta property="article:author" content="ZDDR">
<meta property="article:tag" content="ZDDR,逆向,内核,Pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.ax1x.com/2020/01/03/lNWQhD.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zddr.net/2020/02/29/Windows%E7%BC%96%E7%A8%8B%E5%B0%8F%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: ZDDR","link":"链接: ","source":"来源: ZDDR's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-09-07 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = '1'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://gitee.com/ZDDR/blog_img/raw/master/img/index_img/%E8%87%AA%E5%B7%B1%E7%9A%84%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s2.ax1x.com/2020/01/03/lNWQhD.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ZDDR's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Windows编程小记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-02-28T16:00:00.000Z" title="发表于 2020-02-29 00:00:00">2020-02-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-09-06T16:00:00.000Z" title="更新于 2020-09-07 00:00:00">2020-09-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows%E7%BC%96%E7%A8%8B/">Windows编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="DLL"><a href="#DLL" class="headerlink" title="DLL"></a>DLL</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">	HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//DLL模块的句柄 handle Module</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD ul_reason_for_call</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//DLLMain函数被调用的原因</span></span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//Windows保留参数 必须为NULL</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//DLLMain函数被调用的原因</span></span><br><span class="line">	<span class="keyword">switch</span>(ul_reason_for_call)</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">		<span class="comment">//当DLL被进程加载时DLLMain被调用</span></span><br><span class="line">		<span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">		<span class="comment">//有进程创建时DLLMain被调用</span></span><br><span class="line">		<span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">		<span class="comment">//有线程结束时DLLMain被调用</span></span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">		<span class="comment">//当DLL被进程卸载时DLLMain被调用</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="导出函数"><a href="#导出函数" class="headerlink" title="导出函数"></a>导出函数</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明导出函数-&gt;将a函数导出</span></span><br><span class="line"><span class="comment">//加上 extern &quot;c&quot; 后 会指示编译器这部分代码按c语言的进行编译</span></span><br><span class="line"><span class="comment">//__declspec(dllexport)：声明导出函数 若要使函数成为DLL接口的一部分 必须将其他模块钟函数的定义声明为dllexport</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;c&quot;</span> __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="应用程序与导出函数进行通讯"><a href="#应用程序与导出函数进行通讯" class="headerlink" title="应用程序与导出函数进行通讯"></a>应用程序与导出函数进行通讯</h1><h2 id="静态调用"><a href="#静态调用" class="headerlink" title="静态调用"></a>静态调用</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">调用静态库 格式#pragma comment(comment-type,[&quot;commentstring&quot;])</span></span><br><span class="line"><span class="comment">comment-type 是一个预定义的标识符，指定注释的类型，应该是compiler,exestr,lib,linker之一。</span></span><br><span class="line"><span class="comment">compiler 放置编译器的版本或名字到一个对象文件，该选项是被linker忽略的。</span></span><br><span class="line"><span class="comment">exestr 以后的版本将会取消</span></span><br><span class="line"><span class="comment">lib 静态库，填写路径即可</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">linker：指定一个连接选项，这样就不用在命令行输入或者在开发环境中设置了。只有下面的linker选项能被传给Linker：</span></span><br><span class="line"><span class="comment">/DEFAULTLIB</span></span><br><span class="line"><span class="comment">/EXPORT</span></span><br><span class="line"><span class="comment">/INCLUDE</span></span><br><span class="line"><span class="comment">/MANIFESTDEPENDENCY</span></span><br><span class="line"><span class="comment">/MERGE</span></span><br><span class="line"><span class="comment">/SECTION</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">commentstring 是一个提供为comment-type提供附加信息的字符串。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;LIB_PATH&quot;</span>)</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="keyword">void</span> <span class="title">a</span> <span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	a();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="动态调用"><a href="#动态调用" class="headerlink" title="动态调用"></a>动态调用</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="comment">//定义一个函数指针类型</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*PMessage_Box)</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//将指定的模块加载到调用进程的地址空间中 获取句柄</span></span><br><span class="line">	HMODULE hModule = LoadLibrary(<span class="string">&quot;DLLPATH&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断句柄是否为空</span></span><br><span class="line">	<span class="keyword">if</span> (hModule == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	GetProcAddress 从dll中检索导出的函数或变量的地址</span></span><br><span class="line"><span class="comment">	FARPROC GetProcAddress(HMODULE hModule,LPCSTR lpProcName);</span></span><br><span class="line"><span class="comment">	参数hModule为包含函数或变量的DLL模块的句柄。</span></span><br><span class="line"><span class="comment">	参数lpProcName为函数或变量名称，或函数的序数值。如果此参数是序数值，则必须使用低位字；高阶字必须为零。</span></span><br><span class="line"><span class="comment">	执行成功 返回值为导出的函数或变量的地址 执行失败返回NULL</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	PMessage_Box pMsg = (PMessage_Box)GetProcAddress(hModule,<span class="string">&quot;function_name&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//调用</span></span><br><span class="line">	pMsg();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="DLL注入"><a href="#DLL注入" class="headerlink" title="DLL注入"></a>DLL注入</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Inject</span> <span class="params">(<span class="keyword">int</span> pID,<span class="keyword">char</span>* Path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	获取进程句柄</span></span><br><span class="line"><span class="comment">	HANDLE OpenProcess(</span></span><br><span class="line"><span class="comment">  		DWORD dwDesiredAccess,</span></span><br><span class="line"><span class="comment">  		BOOL  bInheritHandle,</span></span><br><span class="line"><span class="comment">  		DWORD dwProcessId</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">	dwDesiredAccess 访问权限的设置。</span></span><br><span class="line"><span class="comment">	bInheritHandle 如果此值为TRUE，则此进程创建的进程将继承该句柄。否则，进程将不会继承此句柄。</span></span><br><span class="line"><span class="comment">	dwProcessId 要打开的本地进程的标识符。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,pID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	申请一块内存给传入的路径</span></span><br><span class="line"><span class="comment">	LPVOID VirtualAllocEx(</span></span><br><span class="line"><span class="comment">  		HANDLE hProcess,</span></span><br><span class="line"><span class="comment">  		LPVOID lpAddress,</span></span><br><span class="line"><span class="comment">  		SIZE_T dwSize,</span></span><br><span class="line"><span class="comment">  		DWORD  flAllocationType,</span></span><br><span class="line"><span class="comment">  		DWORD  flProtect</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">	hProcess 进程的句柄</span></span><br><span class="line"><span class="comment">	lpAddress 该指针为要分配的页面区域指定所需的起始地址。如果为NULL，则该函数确定将区域分配到的位置。</span></span><br><span class="line"><span class="comment">	dwSize 要分配的内存区域的大小，以字节为单位。</span></span><br><span class="line"><span class="comment">	flAllocationType 内存分配的类型。</span></span><br><span class="line"><span class="comment">	flProtect 对要分配的页面区域的内存保护。</span></span><br><span class="line"><span class="comment">	如果函数成功，则返回值是页面分配区域的基地址。如果函数失败，则返回值为NULL。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	LPVOID pReturnAddress = VirtualAllocEx(hProcess,<span class="literal">NULL</span>,<span class="built_in">strlen</span>(Path)+<span class="number">1</span>,MEM_COMMIT,PAGE_READWRITE);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	将路径写入上面申请的内存</span></span><br><span class="line"><span class="comment">	BOOL WriteProcessMemory(</span></span><br><span class="line"><span class="comment">  		HANDLE  hProcess,</span></span><br><span class="line"><span class="comment">  		LPVOID  lpBaseAddress,</span></span><br><span class="line"><span class="comment">  		LPCVOID lpBuffer,</span></span><br><span class="line"><span class="comment">  		SIZE_T  nSize,</span></span><br><span class="line"><span class="comment">  		SIZE_T  *lpNumberOfBytesWritten</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">	hProcess 要修改的过程存储器的句柄。</span></span><br><span class="line"><span class="comment">	lpBaseAddress 指向要写入数据的指定进程中的基地址的指针。</span></span><br><span class="line"><span class="comment">	lpBuffer 指向缓冲区的指针</span></span><br><span class="line"><span class="comment">	nSize 要写入指定进程的字节数。</span></span><br><span class="line"><span class="comment">	lpNumberOfBytesWritten 指向变量的指针，该变量接收传输到指定进程中的字节数。为NULL则忽略该参数。</span></span><br><span class="line"><span class="comment">	如果函数执行成功，则返回值为非零。如果函数执行失败，则返回值为0（零）。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	WriteProcessMemory(hProcess,pReturnAddress,Path,<span class="built_in">strlen</span>(Path)+<span class="number">1</span>,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取LoadLibraryA函数的地址</span></span><br><span class="line">	HMODULE hModule = LoadLibrary(<span class="string">&quot;KERNEL32.DLL&quot;</span>);</span><br><span class="line">	LPTHREAD_START_ROUTINE lpStartAddress = (LPTHREAD_START_ROUTINE)GetProcAddress(hModule,<span class="string">&quot;LoadLibraryA&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	创建在另一个进程的虚拟地址空间中运行的线程</span></span><br><span class="line"><span class="comment">	HANDLE CreateRemoteThread(</span></span><br><span class="line"><span class="comment">  		HANDLE                 hProcess,</span></span><br><span class="line"><span class="comment">  		LPSECURITY_ATTRIBUTES  lpThreadAttributes,</span></span><br><span class="line"><span class="comment">  		SIZE_T                 dwStackSize,</span></span><br><span class="line"><span class="comment">  		LPTHREAD_START_ROUTINE lpStartAddress,</span></span><br><span class="line"><span class="comment">  		LPVOID                 lpParameter,</span></span><br><span class="line"><span class="comment">  		DWORD                  dwCreationFlags,</span></span><br><span class="line"><span class="comment">  		LPDWORD                lpThreadId</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	hProcess 进程句柄</span></span><br><span class="line"><span class="comment">	lpThreadAttributes 指向SECURITY_ATTRIBUTES结构的指针</span></span><br><span class="line"><span class="comment">	dwStackSize 堆栈的初始大小，以字节为单位。系统将此值舍入到最接近的页面。如果此参数为0（零），则新线程使用可执行文件的默认大小。</span></span><br><span class="line"><span class="comment">	lpStartAddress 指向由线程执行的，类型为LPTHREAD_START_ROUTINE的应用程序定义的函数的指针，该指针表示远程进程中线程的起始地址。</span></span><br><span class="line"><span class="comment">	lpParameter 指向要传递给线程函数的变量的指针。</span></span><br><span class="line"><span class="comment">	dwCreationFlags 控制线程创建的标志。值0  线程在创建后立刻运行。</span></span><br><span class="line"><span class="comment">	lpThreadId 指向接收线程标识符的变量的指针，如果此参数为NULL，则不返回线程标识符。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//创建远程线程 并获取线程句柄</span></span><br><span class="line">	<span class="comment">//CreateRemoteThread(进程句柄,NULL,0,lpStartAddress,指向要传递给线程函数的变量的指针,0,NULL);</span></span><br><span class="line">	HANDLE hThread = CreateRemoteThread(hProcess,<span class="literal">NULL</span>,<span class="number">0</span>,lpStartAddress,pReturnAddress,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	等待线程事件 防止线程阻塞</span></span><br><span class="line"><span class="comment">	DWORD WaitForSingleObject(</span></span><br><span class="line"><span class="comment">  		HANDLE hHandle,</span></span><br><span class="line"><span class="comment">  		DWORD  dwMilliseconds</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">	hHandle 对象的句柄。</span></span><br><span class="line"><span class="comment">	dwMilliseconds 超时时间间隔（以毫秒为单位）。</span></span><br><span class="line"><span class="comment">	如果dwMilliseconds为INFINITE，则该函数仅在发出信号通知对象时(永久等待 线程执行完毕 获取到句柄)返回。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	WaitForSingleObject(hThread,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//关闭打开对象句柄 防止内存泄漏</span></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span>* a =<span class="string">&quot;DLL_PATH&quot;</span>;</span><br><span class="line">	Inject (pID,(<span class="keyword">char</span>*)a)；</span><br><span class="line">	<span class="comment">//不强转char* 新版vs会提示实参与形参不兼容</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="卸载模块"><a href="#卸载模块" class="headerlink" title="卸载模块"></a>卸载模块</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">BOOL FreeLibrary(</span></span><br><span class="line"><span class="comment">  HMODULE hLibModule</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment">hLibModule加载的库模块的句柄。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">FreeLibrary();</span><br></pre></td></tr></table></figure>
<h1 id="获取进程ID"><a href="#获取进程ID" class="headerlink" title="获取进程ID"></a>获取进程ID</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetProcessID</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//获取窗体句柄</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	HWND FindWindowA(</span></span><br><span class="line"><span class="comment">  		LPCSTR lpClassName,</span></span><br><span class="line"><span class="comment">  		LPCSTR lpWindowName</span></span><br><span class="line"><span class="comment">	);</span></span><br><span class="line"><span class="comment">	//lpClassName </span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	HWND GetHandleID;</span><br><span class="line">	GetHandleID=FindWindowA(<span class="string">&quot;lpClassName&quot;</span>, <span class="string">&quot;lpWindowName&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (GetHandleID != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;句柄为:%x&quot;</span>,GetHandleID);</span><br><span class="line">		<span class="comment">//获取进程id</span></span><br><span class="line">		DWORD _pid;</span><br><span class="line">		DWORD test;</span><br><span class="line">		BOOL flag = GetWindowThreadProcessId(GetHandleID, &amp;_pid);</span><br><span class="line">		<span class="keyword">if</span> (flag != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;进程ID为:%d&quot;</span>, _pid);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;获取ID失败&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		getchar();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;获取句柄失败&quot;</span>);</span><br><span class="line">		getchar();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,pID);</span><br><span class="line"><span class="comment">//获取自己的句柄</span></span><br><span class="line">HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,GetCurrentProcessId());</span><br></pre></td></tr></table></figure>
<h1 id="c语言调用Call"><a href="#c语言调用Call" class="headerlink" title="c语言调用Call"></a>c语言调用Call</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内联汇编</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Funcname</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		push xxx</span><br><span class="line">		mov eax,xxx</span><br><span class="line">		call eax</span><br><span class="line">		add sep,<span class="number">0x6</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyCall</span><span class="params">(DWORD pID,DWORD _CallAddress,LPVOID Funcname)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS,FALSE,pID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//有参数Call</span></span><br><span class="line">	<span class="keyword">if</span> (_CallAddress == Null)</span><br><span class="line">	&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//申请一块内存给整个CAll</span></span><br><span class="line">	LPVOID CallAddress = VirtualAllocEx(hProcess,<span class="literal">NULL</span>,<span class="number">0x100</span>,MEM_COMMIT,PAGE_READWRITE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将Call数据写入上面分配的内存</span></span><br><span class="line">	WriteProcessMemory(hProcess,CallAddress,Funcname,<span class="number">0x100</span>,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建远程线程 并获取线程句柄</span></span><br><span class="line">	<span class="comment">//CreateRemoteThread(进程句柄,NULL,0,lpStartAddress,指向要传递给线程函数的变量的指针,0,NULL);</span></span><br><span class="line">	HANDLE hThread = CreateRemoteThread(hProcess,<span class="literal">NULL</span>,<span class="number">0</span>,(LPTHREAD_START_ROUTINE)CallAddress,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//等待线程事件 防止线程阻塞</span></span><br><span class="line">	WaitForSingleObject(hThread,<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//关闭打开对象句柄 防止内存泄漏</span></span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">	HANDLE hThread = CreateRemoteThread(hProcess,<span class="literal">NULL</span>,<span class="number">0</span>,(LPTHREAD_START_ROUTINE)_CallAddress,<span class="literal">NULL</span>,<span class="number">0</span>,<span class="literal">NULL</span>);</span><br><span class="line">	WaitForSingleObject(hThread,<span class="number">2000</span>);</span><br><span class="line">	CloseHandle(hThread);</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="DLL调用Call"><a href="#DLL调用Call" class="headerlink" title="DLL调用Call"></a>DLL调用Call</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Funcname</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		push xxx</span><br><span class="line">		mov eax,xxx</span><br><span class="line">		call eax</span><br><span class="line">		add sep,<span class="number">0x6</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">	HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//DLL模块的句柄 handle Module</span></span></span></span><br><span class="line"><span class="function"><span class="params">	DWORD ul_reason_for_call</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//DLLMain函数被调用的原因</span></span></span></span><br><span class="line"><span class="function"><span class="params">	LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="comment">//Windows保留参数 必须为NULL</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//DLLMain函数被调用的原因</span></span><br><span class="line">	<span class="keyword">switch</span>(ul_reason_for_call)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">		Funcname();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="使用多级指针读写值"><a href="#使用多级指针读写值" class="headerlink" title="使用多级指针读写值"></a>使用多级指针读写值</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DWORD ModuleBase = <span class="number">0x0</span>;</span><br><span class="line">DWORD p1 = <span class="number">0x0</span>;</span><br><span class="line">DWORD p2 = <span class="number">0x0</span>;</span><br><span class="line">DWORD p3 = <span class="number">0x0</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">DWORD add = *(DWORD*)ModuleBase;</span></span><br><span class="line"><span class="comment">DWORD add2 = *(DWORD*)(add + p1);</span></span><br><span class="line"><span class="comment">DWORD add3 = *(DWORD*)(add2 + p2);</span></span><br><span class="line"><span class="comment">DWORD address = add3 + p3;</span></span><br><span class="line"><span class="comment">*(DWORD*)address = xxx;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">*(DWORD*)((*(DWORD*)((*(DWORD*)((*(DWORD*)ModuleBase)+p1))+p2))+p3) = xxx;</span><br></pre></td></tr></table></figure>
<h1 id="创建线程"><a href="#创建线程" class="headerlink" title="创建线程"></a>创建线程</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">HANDLE CreateThread(</span></span><br><span class="line"><span class="comment">  LPSECURITY_ATTRIBUTES   lpThreadAttributes,</span></span><br><span class="line"><span class="comment">  SIZE_T                  dwStackSize,</span></span><br><span class="line"><span class="comment">  LPTHREAD_START_ROUTINE  lpStartAddress,</span></span><br><span class="line"><span class="comment">  __drv_aliasesMem LPVOID lpParameter,</span></span><br><span class="line"><span class="comment">  DWORD                   dwCreationFlags,</span></span><br><span class="line"><span class="comment">  LPDWORD                 lpThreadId</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">lpThreadAttributes</span></span><br><span class="line"><span class="comment">指向SECURITY_ATTRIBUTES 结构的指针，该结构确定子进程是否可以继承返回的句柄。如果 lpThreadAttributes为NULL，则不能继承该句柄。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dwStackSize</span></span><br><span class="line"><span class="comment">堆栈的初始大小，以字节为单位。系统将此值舍入到最接近的页面。如果此参数为零，则新线程将使用可执行文件的默认大小。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">lpStartAddress</span></span><br><span class="line"><span class="comment">指向要由线程执行的应用程序定义的函数的指针。该指针表示线程的起始地址。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">lpParameter</span></span><br><span class="line"><span class="comment">指向要传递给线程的变量的指针。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dwCreationFlags</span></span><br><span class="line"><span class="comment">控制线程创建的标志。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)Funcname, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//reinterpret_cast&lt;类型&gt; C++的方式通过指针强转类型</span></span><br><span class="line">CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, <span class="keyword">reinterpret_cast</span>&lt;LPTHREAD_START_ROUTINE&gt;Funcname, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h1 id="使用TabSheet操作MFC的Tab页控件"><a href="#使用TabSheet操作MFC的Tab页控件" class="headerlink" title="使用TabSheet操作MFC的Tab页控件"></a>使用TabSheet操作MFC的Tab页控件</h1><h2 id="TabSheet-h"><a href="#TabSheet-h" class="headerlink" title="TabSheet.h"></a>TabSheet.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(AFX_TABSHEET_H__42EE262D_D15F_46D5_8F26_28FD049E99F4__INCLUDED_)  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AFX_TABSHEET_H__42EE262D_D15F_46D5_8F26_28FD049E99F4__INCLUDED_  </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> _MSC_VER &gt; 1000  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// _MSC_VER &gt; 1000  </span></span></span><br><span class="line"><span class="comment">// TabSheet.h : header file  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////  </span></span><br><span class="line"><span class="comment">// CTabSheet window  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXPAGE 16  </span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTabSheet</span> :</span> <span class="keyword">public</span> CTabCtrl  </span><br><span class="line">&#123;  </span><br><span class="line">	<span class="comment">// Construction  </span></span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">	CTabSheet();  </span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Attributes  </span></span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Operations  </span></span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Overrides  </span></span><br><span class="line">	<span class="comment">// ClassWizard generated virtual function overrides  </span></span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_VIRTUAL(CTabSheet)  </span></span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_VIRTUAL  </span></span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Implementation  </span></span><br><span class="line"><span class="keyword">public</span>:  </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">GetCurSel</span><span class="params">()</span></span>;  </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">SetCurSel</span><span class="params">(<span class="keyword">int</span> nItem)</span></span>;  </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Show</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Free</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">SetRect</span><span class="params">()</span></span>;  </span><br><span class="line">	<span class="function">BOOL <span class="title">AddPage</span><span class="params">(LPCTSTR title, CDialog *pDialog, UINT ID)</span></span>;  </span><br><span class="line">	<span class="keyword">virtual</span> ~CTabSheet();  </span><br><span class="line"> </span><br><span class="line">	<span class="comment">// Generated message map functions  </span></span><br><span class="line"><span class="keyword">protected</span>:  </span><br><span class="line">	LPCTSTR m_Title[MAXPAGE];  </span><br><span class="line">	UINT m_IDD[MAXPAGE];  </span><br><span class="line">	CDialog* m_pPages[MAXPAGE];  </span><br><span class="line">	<span class="keyword">int</span> m_nNumOfPages;  </span><br><span class="line">	<span class="keyword">int</span> m_nCurrentPage;  </span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG(CTabSheet)  </span></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span>;  </span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG  </span></span><br><span class="line"> </span><br><span class="line">	DECLARE_MESSAGE_MAP()  </span><br><span class="line">&#125;;  </span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//&#123;&#123;AFX_INSERT_LOCATION&#125;&#125;  </span></span><br><span class="line"><span class="comment">// Microsoft Visual C++ will insert additional declarations immediately before the previous line.  </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// !defined(AFX_TABSHEET_H__42EE262D_D15F_46D5_8F26_28FD049E99F4__INCLUDED_)  </span></span></span><br></pre></td></tr></table></figure>
<h2 id="TabSheet-cpp"><a href="#TabSheet-cpp" class="headerlink" title="TabSheet.cpp"></a>TabSheet.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TabSheet.cpp : implementation file  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span>  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;TabSheet.h&quot;</span>  </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _DEBUG  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> new DEBUG_NEW  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> THIS_FILE  </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> THIS_FILE[] = __FILE__;  </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////  </span></span><br><span class="line"><span class="comment">// CTabSheet  </span></span><br><span class="line"> </span><br><span class="line">CTabSheet::CTabSheet()  </span><br><span class="line">&#123;  </span><br><span class="line">	m_nNumOfPages = <span class="number">0</span>;  </span><br><span class="line">	m_nCurrentPage = <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line">CTabSheet::~CTabSheet()  </span><br><span class="line">&#123;  </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">BEGIN_MESSAGE_MAP(CTabSheet, CTabCtrl)  </span><br><span class="line">	<span class="comment">//&#123;&#123;AFX_MSG_MAP(CTabSheet)  </span></span><br><span class="line">	ON_WM_LBUTTONDOWN()  </span><br><span class="line">	<span class="comment">//&#125;&#125;AFX_MSG_MAP  </span></span><br><span class="line">END_MESSAGE_MAP()  </span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////  </span></span><br><span class="line"><span class="comment">// CTabSheet message handlers  </span></span><br><span class="line"> </span><br><span class="line"><span class="function">BOOL <span class="title">CTabSheet::AddPage</span><span class="params">(LPCTSTR title, CDialog *pDialog,UINT ID)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	<span class="keyword">if</span>( MAXPAGE == m_nNumOfPages )  </span><br><span class="line">		<span class="keyword">return</span> FALSE;  </span><br><span class="line"> </span><br><span class="line">	m_nNumOfPages++;  </span><br><span class="line"> </span><br><span class="line">	m_pPages[m_nNumOfPages<span class="number">-1</span>] = pDialog;  </span><br><span class="line">	m_IDD[m_nNumOfPages<span class="number">-1</span>] = ID;  </span><br><span class="line">	m_Title[m_nNumOfPages<span class="number">-1</span>] = title;  </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> TRUE;  </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CTabSheet::SetRect</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	CRect tabRect, itemRect;  </span><br><span class="line">	<span class="keyword">int</span> nX, nY, nXc, nYc;  </span><br><span class="line"> </span><br><span class="line">	GetClientRect(&amp;tabRect);  </span><br><span class="line">	GetItemRect(<span class="number">0</span>, &amp;itemRect);  </span><br><span class="line"> </span><br><span class="line">	nX=itemRect.left;  </span><br><span class="line">	nY=itemRect.bottom+<span class="number">1</span>;  </span><br><span class="line">	nXc=tabRect.right-itemRect.left<span class="number">-2</span>;  </span><br><span class="line">	nYc=tabRect.bottom-nY<span class="number">-2</span>;  </span><br><span class="line"> </span><br><span class="line">	m_pPages[<span class="number">0</span>]-&gt;SetWindowPos(&amp;wndTop, nX, nY, nXc, nYc, SWP_SHOWWINDOW);  </span><br><span class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> nCount=<span class="number">1</span>; nCount &lt; m_nNumOfPages; nCount++ )  </span><br><span class="line">		m_pPages[nCount]-&gt;SetWindowPos(&amp;wndTop, nX, nY, nXc, nYc, SWP_HIDEWINDOW);  </span><br><span class="line"> </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CTabSheet::Show</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">0</span>; i &lt; m_nNumOfPages; i++ )  </span><br><span class="line">	&#123;  </span><br><span class="line">		m_pPages[i]-&gt;Create( m_IDD[i], <span class="keyword">this</span> );  </span><br><span class="line">		InsertItem( i, m_Title[i] );  </span><br><span class="line">	&#125;  </span><br><span class="line"> </span><br><span class="line">	m_pPages[<span class="number">0</span>]-&gt;ShowWindow(SW_SHOW);  </span><br><span class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">1</span>; i &lt; m_nNumOfPages; i++)  </span><br><span class="line">		m_pPages[i]-&gt;ShowWindow(SW_HIDE);  </span><br><span class="line"> </span><br><span class="line">	SetRect();  </span><br><span class="line"> </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CTabSheet::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span>   </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	CTabCtrl::OnLButtonDown(nFlags, point);  </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span>(m_nCurrentPage != GetCurFocus())  </span><br><span class="line">	&#123;  </span><br><span class="line">		m_pPages[m_nCurrentPage]-&gt;ShowWindow(SW_HIDE);  </span><br><span class="line">		m_nCurrentPage=GetCurFocus();  </span><br><span class="line">		m_pPages[m_nCurrentPage]-&gt;ShowWindow(SW_SHOW);  </span><br><span class="line">		<span class="comment">//      m_pPages[m_nCurrentPage]-&gt;SetFocus();  </span></span><br><span class="line">	&#125;  </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CTabSheet::SetCurSel</span><span class="params">(<span class="keyword">int</span> nItem)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	<span class="keyword">if</span>( nItem &lt; <span class="number">0</span> || nItem &gt;= m_nNumOfPages)  </span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">int</span> ret = m_nCurrentPage;  </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span>(m_nCurrentPage != nItem )  </span><br><span class="line">	&#123;  </span><br><span class="line">		m_pPages[m_nCurrentPage]-&gt;ShowWindow(SW_HIDE);  </span><br><span class="line">		m_nCurrentPage = nItem;  </span><br><span class="line">		m_pPages[m_nCurrentPage]-&gt;ShowWindow(SW_SHOW);  </span><br><span class="line">		<span class="comment">//      m_pPages[m_nCurrentPage]-&gt;SetFocus();  </span></span><br><span class="line">		CTabCtrl::SetCurSel(nItem);  </span><br><span class="line">	&#125;  </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> ret;  </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CTabSheet::GetCurSel</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">	<span class="keyword">return</span> CTabCtrl::GetCurSel();  </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//释放page资源</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CTabSheet::Free</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> </span><br><span class="line">	CTabCtrl::DeleteAllItems();</span><br><span class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">0</span>; i &lt; m_nNumOfPages; i++ )  </span><br><span class="line">	&#123;  </span><br><span class="line">		m_pPages[i]-&gt;DestroyWindow();</span><br><span class="line">		m_IDD[i] = <span class="literal">NULL</span>;</span><br><span class="line">		m_Title[i] = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	&#125;  </span><br><span class="line">	m_nCurrentPage = <span class="number">0</span>;</span><br><span class="line">	m_nNumOfPages = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//CTabCtrl::DestroyWindow();  //注意不要将this指针释放了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ZDDR</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zddr.net/2020/02/29/Windows%E7%BC%96%E7%A8%8B%E5%B0%8F%E8%AE%B0/">https://zddr.net/2020/02/29/Windows编程小记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zddr.net" target="_blank">ZDDR's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.ax1x.com/2020/01/03/lNWQhD.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/15/Crack%20Ezviz%20Studio/"><img class="prev-cover" src="https://s1.ax1x.com/2020/08/15/di7FEV.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Crack Ezviz Studio</div></div></a></div><div class="next-post pull-right"><a href="/2020/02/29/C%E8%AF%AD%E8%A8%80%E5%B0%8F%E8%AE%B0/"><img class="next-cover" src="https://s1.ax1x.com/2020/03/12/8mmKE9.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C语言小记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DLL"><span class="toc-number">1.</span> <span class="toc-text">DLL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">导出函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%8E%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E9%80%9A%E8%AE%AF"><span class="toc-number">3.</span> <span class="toc-text">应用程序与导出函数进行通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">静态调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">动态调用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DLL%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">DLL注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">5.</span> <span class="toc-text">卸载模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8BID"><span class="toc-number">6.</span> <span class="toc-text">获取进程ID</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#c%E8%AF%AD%E8%A8%80%E8%B0%83%E7%94%A8Call"><span class="toc-number">7.</span> <span class="toc-text">c语言调用Call</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DLL%E8%B0%83%E7%94%A8Call"><span class="toc-number">8.</span> <span class="toc-text">DLL调用Call</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%A7%E6%8C%87%E9%92%88%E8%AF%BB%E5%86%99%E5%80%BC"><span class="toc-number">9.</span> <span class="toc-text">使用多级指针读写值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B"><span class="toc-number">10.</span> <span class="toc-text">创建线程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8TabSheet%E6%93%8D%E4%BD%9CMFC%E7%9A%84Tab%E9%A1%B5%E6%8E%A7%E4%BB%B6"><span class="toc-number">11.</span> <span class="toc-text">使用TabSheet操作MFC的Tab页控件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TabSheet-h"><span class="toc-number">11.1.</span> <span class="toc-text">TabSheet.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TabSheet-cpp"><span class="toc-number">11.2.</span> <span class="toc-text">TabSheet.cpp</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(https://s2.ax1x.com/2020/01/03/lNWQhD.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By ZDDR</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>